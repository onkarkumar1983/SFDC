var originalPlaceholder="",postToCommentOnId,highlightFlag,comment=!1,currentlightboxtaskid="",dragging=!1,uploadFormInputs=null,sorting=!1,taskToBounce,tempDropBackground,tag,timeoutHnd,dialogOpen=!1,columnView,deadlineView,lastManualDOMChange=0,scrollbarWidth=0,taskCardTemplate,columnViewLastEditedItem=null,updateListSortOrderOnHighlihgt=null,afterInitialLoadMethod;$j=jQuery.noConflict();afterLoad=afterLoad=function(){return{run:function(){}}}();
defineAfterLoad=function(a,b){switch(a){case "firstLoad":afterLoad=function(){return{run:function(){"completeTask"==b.action&&(moveTasksToColumn([b.taskId],b.changeList),scrollToAndHighlightTask(b.taskId));defineAfterLoad("afterFirstLoad")}}}();break;case "afterFirstLoad":afterLoad=function(){return{run:function(){}}}();break;default:afterLoad=function(){return{run:function(){}}}()}};
$j(document).ready(function(){taskCardTemplate=Handlebars.compile($j("#newTaskCardTemplate").html().trim());taskCardTemplateDeadline=Handlebars.compile($j("#newTaskTemplate-deadline").html().trim());sidebarChatterPostTemplate=Handlebars.compile($j("#sidebar-chatter-post-template").html().trim());$j("#container-fluid").append("<div id='scrollbar-measure' class='scrollbar-measure'></div>");var a=document.getElementById("scrollbar-measure");scrollbarWidth=a.offsetWidth-a.clientWidth;$j("#scrollbar-measure").remove();
$j(".modal").on("shown",function(){$j(".task-column .sortable-list").css("overflow-y","hidden");$j("#viewport-container").css("overflow-x","hidden");var a=$j(this);$j(a).height()>$j(window).height()&&($j(a).height($j(window).height()-4),$j(a).children(".big-modal-body").height($j(window).height()-4));a.css("margin-top",-1*(a.outerHeight(!1)/2)).css("margin-left",-1*(a.outerWidth(!1)/2));return this});$j(".modal").on("hidden",function(){var a=$j(this);$j(a).css("height","");$j(a).children(".big-modal-body").height("")});
$j(".modal").on("hide",function(){$j(".task-column .sortable-list").css("overflow-y","auto");$j("#viewport-container").css("overflow-x","auto")});populateActionBarButtons();columnViewPortWidthRecalc();a=GetUrlArguments();null!=a.view&&$j.cookie("bltr_view",a.view,{expires:365,path:"/",secure:!0});if("project"==currentBoardId)if(null!=a.change_list&&null!=a.taskid){var b=a.change_list,c=a.taskid,b={action:"completeTask",taskId:c,changeList:b};defineAfterLoad("firstLoad",b)}else null!=a.projectid&&
null!=a.taskid?($j.cookie("apex__bltrProjectId",a.projectid,{expires:365,path:"/",secure:!0}),$j("#task-frame").contents().empty(),$j("#task-frame").attr("src",trProjectTaskPage+"?Id="+a.taskid+"&controller=projecttask"),$j("#task-modal").modal("show"),sorting=!1):null!=a.projectid&&$j.cookie("apex__bltrProjectId",a.projectid,{expires:365,path:"/",secure:!0});"my"==currentBoardId&&(null!=a.change_list&&null!=a.taskid?(b=a.change_list,c=a.taskid,b={action:"completeTask",taskId:c,changeList:b},defineAfterLoad("firstLoad",
b)):null!=a.taskid&&($j("#task-frame").contents().empty(),$j("#task-frame").attr("src",trProjectTaskPage+"?Id="+a.taskid+"&controller=projecttask"),$j("#task-modal").modal("show"),sorting=!1),$j(".pageDescription").html('<div class="input-append"><input class="" id="view-as-input" type="text" value="'+viewAsUserFullName+'"><img id="view-as-info" style="padding-left:2px;" class="pointer" src="'+helpTextIconURL+'" /></div>'),$j("#view-as-info").attr("title",'<div style="text-align:left">Show other user\'s tasks on this board by entering their name. Click "Clear" to reset back to your tasks.</div>'),
$j("#view-as-info").tooltip({placement:"right",delay:{show:500,hide:100}}),attachMyBoardViewAs());attachTaskClickOnFunctions();initPage();"true"==displaySetupWizard&&"true"!=displaySetupWizardCookieHide&&($j("#setup-wizard-frame").find("#center-panel").empty(),$j("#setup-wizard-frame").attr("src",setupWizardPage),$j("#setup-wizard-modal").modal("show"));refreshColumnHeights();global_runConcurrency&&(setTimeout(checkForTaskBoardChanges,global_pollingInterval),setTimeout(checkForProjectSideboardChanges,
global_pollingInterval));$j("#phSearchInput").css("height","85%");$j("#phSearchInput").css("width","100%");$j(".modal-frame").contents().empty();$j("input, textarea").placeholder()});var resizeTimer,previousWindowWidth=$j(window).width(),previousWindowHeight=$j(window).height();
$j(window).resize(function(){columnViewPortWidthRecalc();refreshColumnHeights();clearTimeout(resizeTimer);if($j(window).width()!=previousWindowWidth||$j(window).height()!=previousWindowHeight)resizeTimer=setTimeout(windowResizeHandler,800),previousWindowWidth=$j(window).width(),previousWindowHeight=$j(window).height()});function windowResizeHandler(){}
function initPage(){showLoadMask(function(){"group"!=currentBoardId?($j(".pageTitleIcon").attr("src",getSmallPhotoURL()),initPageAfterSidebar()):populateChatterGroupSelect(function(){updateHeaderImageWithChatterGroup();initPageAfterSidebar()})})}
function initPageAfterSidebar(){attachSidebarFunctions();attachHeaderClickFunctions();attachSortable();attachUiHelperMessages();populateProjects(function(){setBoardView(function(a){"columns-view"==a&&populateColumns(function(){attachColumnClickFunctions();setColumnView(function(){refreshTasks()})});"deadline-view"==a&&setColumnView(function(){populateDeadlineView();updateBoardHeader()});"planning-view"==a&&setColumnView(function(){populatePlanningView();updateBoardHeader()})})})}
function refreshTasks(){if("my"==currentBoardId){var a=[];$j(".display-unassigned-tasks").is(":checked")?($j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'")}),a.push("''")):$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'")});var b=0<a.length?a.join(","):"''",c=currentBoardId;!$j(".display-unassigned-tasks").is(":checked")&&"''"==b&&(c="empty");populateTasks(c,b,function(){attachSortable();setColumnView(function(){$j("#task-board").unmask();
$j("#canvasloader-container").hide();afterLoad.run();scrollToAndHighlightTask(columnViewLastEditedItem);columnViewLastEditedItem=null;afterBoardChange()})})}"project"==currentBoardId&&(a=[],$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'")}),b=0<a.length?a.join(","):"''",populateTasks(currentBoardId,b,function(){$j(".task-list").css("display","block");$j("#canvasloader-container").hide();attachSortable();setColumnView(function(){$j("#task-board").unmask();
$j("#canvasloader-container").hide();afterLoad.run();updateBoardHeader();scrollToAndHighlightTask(columnViewLastEditedItem);columnViewLastEditedItem=null;afterBoardChange()})}));"group"==currentBoardId&&(a=[],$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'")}),b=0<a.length?a.join(","):"''",setBoardView(function(a){a=="columns-view"&&populateTasks(currentBoardId,b,function(){afterLoad.run();attachSortable();attachTaskClickFunctions();$j("#task-board").unmask();
$j("#canvasloader-container").hide();updateBoardHeader();scrollToAndHighlightTask(columnViewLastEditedItem);columnViewLastEditedItem=null;afterBoardChange()})}));attachSortable()}
function updateBoardHeader(){"project"==currentBoardId?$j(".pageDescription").html($j(".project-select:not(.project-sidebar-inactive)").children("a").html()):"group"==currentBoardId&&($j(".pageDescription").html($j("#chatter-group-dropdown option:selected").text()),$j(".pageTitleIcon").attr("src",$j("#chatter-group-dropdown option:selected").attr("image")))}
function showLoadMask(a){$j("#canvasloader-container").empty();if(!dialogOpen){$j("#task-board").mask();$j("#canvasloader-container").show();var b=new CanvasLoader("canvasloader-container");b.setColor("#0099ff");b.setDiameter(84);b.setDensity(75);b.setRange(1);b.setFPS(26);b.show();$j("#canvasLoader").css("margin-top",-1*($j("#canvasLoader").outerHeight(!1)/2));$j("#canvasLoader").css("margin-left",-1*($j("#canvasLoader").outerWidth(!1)/2));$j("#canvasLoader").css("position","fixed");$j("#canvasLoader").css("top",
$j(window).height()/2);$j("#canvasLoader").css("left",$j(window).width()/2)}$j(".task").remove();$j(".deadline-view-task").remove();a()}
function populateProject(a){skipPoll=!0;TASKRAY.trController.fetchProject_v2(a,getViewAsUserId(),function(b,c){!0==c.status&&$j.each(b,function(b,c){"true"==c.following&&($j("#"+a).find(".project-follow").attr("src",unFollowIconURL),$j("#"+a).find(".project-follow-img").addClass("project-unfollow-img"),$j("#"+a).find(".project-follow-img").removeClass("project-follow-img"));"false"==c.following&&($j("#"+a).find(".project-follow").attr("src",followIconURL),$j("#"+a).find(".project-unfollow-img").addClass("project-follow-img"),
$j("#"+a).find(".project-unfollow-img").removeClass("project-unfollow-img"))});skipPoll=!1})}
function populateSearchProject(a){TASKRAY.trController.fetchProject_v2(a,getViewAsUserId(),function(b,c){!0==c.status&&$j.each(b,function(b,c){"true"==c.following&&($j("#projectSearchResults #"+a+" .project-follow").attr("src",unFollowIconURL),$j("#projectSearchResults #"+a+" .project-follow-img").addClass("project-unfollow-img"),$j("#projectSearchResults #"+a+" .project-follow-img").removeClass("project-follow-img"));"false"==c.following&&($j("#projectSearchResults #"+a+" .project-follow").attr("src",
followIconURL),$j("#projectSearchResults #"+a+" .project-unfollow-img").addClass("project-follow-img"),$j("#projectSearchResults #"+a+" .project-unfollow-img").removeClass("project-unfollow-img"))})})}
function searchProjects(){var a=$j("#projectSearchTermInput").val();if(3<=a.length){var b="false";$j("#searchArchivedInput").is(":checked")&&(b="true");TASKRAY.trController.searchProjectsArchive(a,b,function(a,b){!0==b.status&&($j("#projectSearchResults").html(""),$j.each(a,function(a,b){if("group"==currentBoardId&&(null==b.project.TASKRAY__ChatterGroupSharingIds__c&&(b.project.TASKRAY__ChatterGroupSharingIds__c=""),null!=$j("#chatter-group-dropdown").val()&&-1==b.project.TASKRAY__ChatterGroupSharingIds__c.indexOf($j("#chatter-group-dropdown").val())))b.showChatterGroupAdd=
!0;b.hierarchyLevel=0;var c=$j("#projectTemplate-sidebar").tmpl(b);$j("#projectSearchResults").append(c)}),attachSidebarFunctions(),$j("#projectSearchResults .project-select").addClass("search-project-select"),$j("#projectSearchResults .project-select").removeClass("project-select"),attachSearchFixFunctions())})}}
function attachSearchFixFunctions(){bindClickFunction($j("#projectSearchResults .search-project-select"),function(){});$j("#projectSearchResults .project-list-square").each(function(a,b){$j(b).css("border-color",$j("#"+$j(b).attr("id")+"-color").val());$j(b).css("background-color",$j("#"+$j(b).attr("id")+"-color").val())});$j("#projectSearchResults .project-actions").css("visibility","visible");bindClickFunction($j(".addProjectToChatterGroup"),function(){var a=[];a.push($j("#chatter-group-dropdown").val());
var b=$j(this).parent().parent().attr("id"),c=$j("#"+b+"-shared-chatter-groups").val().split(",");$j(c).each(function(b,c){"[]"!=c&&a.push(c)});var c=$j(this).parent().parent().children("a").text(),d=$j("#chatter-group-dropdown option:selected").text();confirmStr='You are about to share "'+c+'" with the "'+d+'" Chatter group. Would you like to continue?  <br /><br />NOTE: This will allow the "'+d+"\" group to see this project on TaskRay's Group Board but will not prevent non-group members from finding it. If you need to make this project private, discuss security with your Salesforce administrator.";
$j("#addProjectToGroup-confirm .modal-body").html(confirmStr);$j("#addProjectToGroup-confirm").modal({backdrop:!1,show:!0});bindClickFunction($j("#addProjectToGroup-confirm-btn"),function(){TASKRAY.trController.updateProjectGroupSharing(a,b,function(){searchProjects();initPage();$j("#addProjectToGroup-confirm").modal("hide")},{escape:!0})})})}function setFormatDate(a){$j("#"+a).find(".task-deadline").text(result.toString());$j("#"+a).find(".task-deadline").effect("hightlight",200)}
function getCurrentTaskTags(){TASKRAY.trController.recordTags(currentlightboxtaskid,function(a,b){b.status&&(0<b.result.length?function(a){$j.each(b.result,function(b,e){"true"==$j("#edit-mode").val()?$j("#tag-list").append('<div id="'+e.Id+'" class="delete-tag"><span class="delete-tag-text" id="'+e.Id+'">'+e.Name+'</span><img id="'+e.Id+'" class="delete-tag-img" src="'+redx+'" /></div>'):$j("#tag-list").append('<span class="project-task-tag" id="'+e.Id+'">'+e.Name+'</span><img class="tag-image" src="'+
tagimg+'" />');a()})}(function(){attachPageClickFunctions()}):attachPageClickFunctions())})}
function attachPageClickFunctions(){bindClickFunction($j(".delete-tag"),function(){tag=$j(this);$j(this).highlight();skipPoll=!0;TASKRAY.trController.deleteRecordTag($j(this).attr("id"),function(a,b){b.status&&$j(tag).hide();skipPoll=!1})});bindClickFunction($j("#add-tags-btn"),function(a){a.preventDefault();a=$j("#tag-input").val().split(",");skipPoll=!0;TASKRAY.trController.addRecordTags(a,currentlightboxtaskid,function(a,c){c.status&&function(a){$j.each(c.result,function(a,b){$j("#tag-list").append('<span class="project-task-tag" id="'+
b.Id+'">'+b.Name+'</span><img class="tag-image" src="'+tagimg+'" />')});a()}(function(){attachPageClickFunctions()});skipPoll=!1})})}function highlightTaskRemove(){"planning"==$j.cookie("bltr_view")?initPage():setTimeout('$j("#"+currentlightboxtaskid).hide("puff",{},500,function(){$j("#"+currentlightboxtaskid).queue("fx",function(){$j("#"+currentlightboxtaskid).remove();})});',500)}
function getBoardInfo(){returnArr={};if("my"==currentBoardId){var a=[],b=[];$j(".display-unassigned-tasks").is(":checked")?($j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'");b.push(this.id)}),a.push("''")):$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'");b.push(this.id)});var c=0<a.length?a.join(","):"''",d=currentBoardId;!$j(".display-unassigned-tasks").is(":checked")&&"''"==c&&(d="empty");returnArr.boardParam=
d;returnArr.wherestr=c;returnArr.projectIds=b}"project"==currentBoardId&&(a=[],b=[],$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'");b.push(this.id)}),c=0<a.length?a.join(","):"''",d=currentBoardId,"''"==c&&(d="empty"),returnArr.boardParam=d,returnArr.wherestr=c,returnArr.projectIds=b);"group"==currentBoardId&&(a=[],b=[],$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push("'"+this.id+"'");b.push(this.id)}),0<a.length?c=a.join(","):
(c="''",$j(".toggleprojects").attr("checked","checked")),returnArr.boardParam=currentBoardId,returnArr.wherestr=c,returnArr.projectIds=b);return returnArr}
function attachsidebarProjectLinksClickFunctions(){bindClickFunction($j(".project-file-filelink"),function(){window.open("/"+$j(this).attr("id"),"_blank").focus();return!1});bindClickFunction($j(".project-file-link"),function(){window.open($j(this).attr("href"),"_blank").focus();return!1});$j(".project-action-icon-editContribs-tooltip").tooltip({placement:"left",delay:{show:500,hide:100}})}
var taskChangeTimeStampStart=0,taskChangeTimeStampEnd=0,last_taskChangeTimeStampStart=0,last_taskChangeTimeStampEnd=0,checkForTaskboardChangesTimeout;
function checkForTaskBoardChanges(a){currentTime=(new Date).getTime();!0!=skipPoll&&!0!=dragging&&currentTime-lastManualDOMChange>global_pollingInterval||a?(last_taskChangeTimeStampStart=taskChangeTimeStampStart,last_taskChangeTimeStampEnd=taskChangeTimeStampEnd,taskChangeTimeStampStart=(new Date).getTime(),taskChangeTimeStampEnd=taskChangeTimeStampStart+global_pollingInterval,boardInfo=getBoardInfo(),TASKRAY.trController.fetchTasks_v2(boardInfo.boardParam,boardInfo.wherestr,getViewAsUserId(),function(b,
c){if(!0==c.status){if(!0!=skipPoll&&!0!=dragging&&currentTime-lastManualDOMChange>global_pollingInterval||a){var d=[];$j.each(b,function(a,b){d.push([b,b.sortOrder])});d.sort(function(a,b){return a[1]===b[1]?b[0].task.CreatedDate-a[0].task.CreatedDate:a[1]-b[1]});Object.equals(d,persistedsortable)||quickRefreshAllTasks(b)}}else(-1!=c.message.indexOf("'syntax error'.  Logged in?")||-1!=c.message.indexOf("Remoting request invalid for your session.  Refresh page and re-submit request"))&&location.reload(!0);
clearTimeout(checkForTaskboardChangesTimeout);checkForTaskboardChangesTimeout=setTimeout(checkForTaskBoardChanges,global_pollingInterval)})):(clearTimeout(checkForTaskboardChangesTimeout),checkForTaskboardChangesTimeout=setTimeout(checkForTaskBoardChanges,global_pollingInterval))}
function findTaskNotificationsForTaskBoard(a,b){oldInfo={};$j.each(a,function(a,b){oldInfo[b[0].task.Id]=b[0].task.LastModifiedDate});newInfo={};$j.each(b,function(a,b){newInfo[b[0].task.Id]=b[0].task.LastModifiedDate});diff=$j.objectDiff(oldInfo,newInfo);whereObj={};$j.each(diff,function(a,b){whereObj[a]=b[1]});whereArr=[];$j.each(whereObj,function(a){whereArr.push(a)});type="task";TASKRAY.trController.fetchNotifications(type,whereArr,last_taskChangeTimeStampStart,last_taskChangeTimeStampEnd,function(a,
b){!0==b.status&&(notificationStr="",$j.each(a,function(a,b){var c=b.TASKRAY__EventDescr__c;notificationStr=notificationStr+$j("<div/>").html(c).text()+"<br />"}),""!=notificationStr&&$j.noty({text:notificationStr,theme:"noty_theme_twitter",layout:"topCenter",type:"alert",animateOpen:{height:"toggle"},animateClose:{height:"toggle"},speed:500,timeout:4E3,closeButton:!0,closeOnSelfClick:!0,closeOnSelfOver:!1,modal:!1}))})}
function updatedPersistedSortableTask(a){skipPoll=!0;$j.each(persistedsortable,function(b,c){if(c[0].task.Id==a.task.Id)return persistedsortable[b][0]=a,skipPoll=!1})}
function setBoardView(a){$j(".nav-view-element").removeClass("active-view");$j(".view").hide();null==$j.cookie("bltr_view")&&$j.cookie("bltr_view","columns",{expires:365,path:"/",secure:!0});var b=$j.cookie("bltr_view");$j("#"+b).addClass("active-view");$j(".nav-view-element").each(function(){$j(this).attr("id")==b?$j(this).children("img").addClass("sprite-"+$j(this).attr("id")+"-view-active"):$j(this).children("img").removeClass("sprite-"+$j(this).attr("id")+"-view-active")});$j(".nav-view-element").hover(function(){$j(this).children("img").addClass("sprite-"+
$j(this).attr("id")+"-view-active")},function(){$j(this).attr("id")==b?$j(this).children("img").addClass("sprite-"+$j(this).attr("id")+"-view-active"):$j(this).children("img").removeClass("sprite-"+$j(this).attr("id")+"-view-active")});"planning"!=b&&($j("#quick-add-text-wrapper .navigate").remove(),$j("#quick-add-text-wrapper .input-append").show());$j("#"+b+"-view").show();a($j("#"+b+"-view").attr("id"))}
function getGlobalSettings(){TASKRAY.trController.getGlobalSettings(function(a,b){!0==b.status&&"function"===typeof callback&&callback()})}function getViewAsUserId(){return"my"==currentBoardId&&null!=parseSFIDCookieValue($j.cookie("apex__bltr_ViewAsUserId"))?$j.cookie("apex__bltr_ViewAsUserId"):currentUserId}function setViewAsUser(a,b){$j.cookie("apex__bltr_ViewAsUserId",a,{expires:365,path:"/",secure:!0});$j.cookie("apex__bltr_ViewAsUserPhotoUrl",b,{expires:365,path:"/",secure:!0})}
function getSmallPhotoURL(){return"my"==currentBoardId&&null!=parseSFIDCookieValue($j.cookie("apex__bltr_ViewAsUserPhotoUrl"))?$j.cookie("apex__bltr_ViewAsUserPhotoUrl"):smallPhotoUrl}function showProjectTaskModal(a){$j("#task-frame").contents().empty();$j("#task-frame").attr("src",trProjectTaskPage+"?Id="+a+"&controller=projecttask");$j("#task-modal").modal("show");sorting=!1}
function showProjectModal(a){$j("#search-projects-modal").modal("hide");$j("#project-frame").contents().find("#project-edit-content").empty();$j("#project-frame").attr("src","about:blank");$j("#project-frame").attr("src",trProjectPage+"?id="+a+"&controller=project");$j("#project-modal").modal("show");chatterGroupIds=""}function columnViewPortWidthRecalc(){$j("#inner-container").is(":visible")&&$j("#inner-container").css("width",$j(window).width()-$j("#sidebar:visible").outerWidth(!0)-22+"px")}
function wbr(a,b){return a.replace(RegExp("(\\w{"+b+"})(\\w)","g"),function(a,b,e){return b+"&shy;"+e})}function getContrastYIQ(a){var a=a.replace("#",""),b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),a=parseInt(a.substr(4,2),16);return 128<=(299*b+587*c+114*a)/1E3?"black":"white"}Array.prototype.unique=function(){var a={},b,c=this.length,d=[];for(b=0;b<c;b+=1)a[this[b]]=this[b];for(b in a)d.push(a[b]);return d};"undefined"===typeof console&&(console={log:function(){},debug:function(){}});
function isValidJSON(a){try{JSON.parse(a)}catch(b){return!1}return!0}function runRemoteActionKeepAlive(){TASKRAY.trController.remoteActionKeepAlive(function(a,b){!0==b.status&&(console.log(a),setTimeout(runRemoteActionKeepAlive,500))})}
function populateColumns(a){$j(".task-column").remove();$j.each(listNameArr,function(a,c){templateVal={};templateVal.listName=c;templateVal.index=a;"project"==currentBoardId&&a==listNameArr.length-1&&(templateVal.archiveButton=!0);$j("#column-container").append($j("#kanbanColumnTemplate").tmpl(templateVal))});0==$j(".modal:visible").length&&($j(".task-column .sortable-list").css("overflow-y","auto"),$j("#viewport-container").css("overflow-x","auto"));setColumnWidths();refreshColumnHeights();"undefined"!==
typeof a&&a()}function attachColumnClickFunctions(){bindClickFunction($j(".task-column .last-column-archive"),function(){$j("#last-list-archive-confirm").modal("show")});bindClickFunction($j("#last-list-archive-confirm-btn"),function(){TASKRAY.trController.archiveProjectTasksInLastColumn($j.cookie("apex__bltrProjectId"),function(){refreshTasks();$j("#last-list-archive-confirm").modal("hide")})})}
function findListNameMapMatch(a){if(void 0!==listNameMap[a])return listNameMap[a];if(void 0!==a){if(a=a.replace("'","\\'"),void 0!==listNameMap[a])return listNameMap[a]}else return 0}
function populateActionBarButtons(){var a="";$j.each(listNameArr,function(b,c){a+='<li id="action-bar-button-column-'+b+'" colnum="'+b+'" class="action-bar-button pointer" style="border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color:'+("undefined"!==typeof globalListColors[b]?globalListColors[b].color:null)+'; "><a href="#" style="text-shadow: none;">'+c+"</a></li>"});$j("#action-bar-button-container").append(a)}
Handlebars.registerHelper("compare",function(a,b,c,d){var e;if(3>arguments.length)throw Error("Handlerbars Helper 'compare' needs 2 parameters");void 0===d&&(d=c,c=b,b="===");e={"==":function(a,b){return a==b},"===":function(a,b){return a===b},"!=":function(a,b){return a!=b},"!==":function(a,b){return a!==b},"<":function(a,b){return a<b},">":function(a,b){return a>b},"<=":function(a,b){return a<=b},">=":function(a,b){return a>=b},"typeof":function(a,b){return typeof a==b}};if(!e[b])throw Error("Handlerbars Helper 'compare' doesn't know the operator "+
b);return e[b](a,c)?d.fn(this):d.inverse(this)});var undoNote=null,undoEvent={};
function addUndoEvent(a){$j.noty.closeAll();undoEvent=a;a="";"deleteTasks"==undoEvent.name?1==undoEvent.data.length?a=undoEvent.data.length+" "+labels.TaskRay_Undo_DeleteTask_Text:1<undoEvent.data.length&&(a=undoEvent.data.length+" "+labels.TaskRay_Undo_DeleteTasks_Text):"taskListChanged"==undoEvent.name?1==undoEvent.data.length?a=undoEvent.data.length+" "+labels.TaskRay_Undo_TaskListChanged_Text:1<undoEvent.data.length&&(a=undoEvent.data.length+" "+labels.TaskRay_Undo_TasksListChanged_Text):"taskOwnerChanged"==
undoEvent.name?1==undoEvent.data.length?a=undoEvent.data.length+" "+labels.TaskRay_Undo_TaskOwnerChanged_Text:1<undoEvent.data.length&&(a=undoEvent.data.length+" "+labels.TaskRay_Undo_TasksOwnerChanged_Text):"taskProjectChanged"==undoEvent.name&&(1==undoEvent.data.length?a=undoEvent.data.length+" "+labels.TaskRay_Undo_TaskProjectChanged_Text:1<undoEvent.data.length&&(a=undoEvent.data.length+" "+labels.TaskRay_Undo_TasksProjectChanged_Text));undoNote=noty({text:a,theme:"noty_theme_twitter",layout:"topCenter",
type:"alert",animateOpen:{height:"toggle"},animateClose:{height:"toggle"},speed:500,timeout:2E4,closeButton:!0,closeOnSelfClick:!0,closeOnSelfOver:!1,modal:!1});$j("#"+undoNote).addClass("undoNotification");$j("#"+undoNote).click(function(a){$j(a.target).hasClass("noty_close")||processUndo()})}
function processUndo(){if("deleteTasks"==undoEvent.name){var a=[];$j.each(undoEvent.data,function(b,c){a.push(c.taskId)});skipPoll=!0;TASKRAY.trController.unDeleteTasks(a,function(b,c){c.status&&(columnViewLastEditedItem=a[0],initPage());skipPoll=!1})}else if("taskListChanged"==undoEvent.name){var b=[];$j.each(undoEvent.data,function(a,c){b.push({Id:c.taskId,SortOrder__c:c.oldSortOrder,List__c:c.oldListName})});skipPoll=!0;TASKRAY.trController.updateTaskListAndSort(b,function(a,c){c.status&&(columnViewLastEditedItem=
b[0].Id,initPage());skipPoll=!1})}else if("taskOwnerChanged"==undoEvent.name){var c=undoEvent.data[0].oldOwnerId,d=[];$j.each(undoEvent.data,function(a,b){d.push(b.taskId)});skipPoll=!0;TASKRAY.trController.assignOwnerSidebarDrop_bulk(d,c,function(a,b){b.status&&(columnViewLastEditedItem=d[0],initPage());skipPoll=!1})}else"taskProjectChanged"==undoEvent.name&&(c=undoEvent.data[0].oldProjectId,d=[],$j.each(undoEvent.data,function(a,b){d.push(b.taskId)}),skipPoll=!0,TASKRAY.trController.assignProjectSidebarDrop_bulk(d,
c,function(a,b){b.status&&(columnViewLastEditedItem=d[0],initPage());skipPoll=!1}));undoEvent={}}function findTaskInSortable(a,b){var c=null;$j.each(a,function(a,e){if(e[0].task.Id==b)return c=e[0],!1});return c}function afterBoardChange(){fetchChatterForSidebar()};function attachHeaderClickFunctions(){bindClickFunction($j("#quick-add-text-btn"),function(){advancedAddLightBox()});bindKeypressFunction($j("#quick-add-text"),function(a){13==a.keyCode&&a.preventDefault();setTimeout(function(){var b=$j("#quick-add-text").val();80<b.length?($j("#quick-add-text-wrapper").addClass("error"),$j("#quick-add-text-btn").alterClass("btn-bs-primary","btn-bs-danger"),$j("#quick-add-text-btn").popover("show")):80>=b.length&&($j("#quick-add-text-wrapper").removeClass("error"),
$j("#quick-add-text-btn").alterClass("btn-bs-danger","btn-bs-primary"),$j("#quick-add-text-btn").popover({trigger:"manual"}).popover("hide"));if(13==a.keyCode&&80>=b.length&&"group"!=currentBoardId&&currentUserId==getViewAsUserId())if(0==b.length)alert("Cannot add a blank task! (Well, we can, but you probably don't want to.)");else if("project"==currentBoardId){var c=$j(".project-select:not(.project-sidebar-inactive)").attr("id");"undefined"===typeof c?(c="projectboard",advancedAddLightBox(),$j("#quick-add-text").val("")):
(addQuickAddLoadMask(),TASKRAY.trController.addTask(b,c,function(a,b){if(b.status==true){b.result.task.buttonType=b.result.task.TASKRAY__List__c!=lastListColName?"Next":"None";b.result.task.Name=wbr(b.result.task.Name,9);$j(taskCardTemplate(b.result)).prependTo("#column-"+defaultListIndex);updateSortOrdersForListWithNoMovement(defaultListIndex);refreshTasks()}if(b.type=="exception")if(b.message.indexOf("REQUIRED_FIELD_MISSING")!=-1){fieldName=b.message.replace(/.*\[/,"").replace(/\]/,"");advancedAddLightBox("Whoops! A required field is missing.")}else if(b.message.indexOf("Required FieldSets")!=
-1){fieldName=b.message.replace(/.*\:/,"");advancedAddLightBox("Whoops! A required field is missing.")}else{parsedMsg=b.message.replace(/.*First\sexception.*first\serror\:\s\w*,/,"");advancedAddLightBox(parsedMsg+"<br />Whoops! TaskRay could not change the list for this task. Check for any required fields or validation rules.")}$j("#quick-add-text").val("");clearQuickAddLoadMask()}))}else addQuickAddLoadMask(),TASKRAY.trController.addTask(b,null,function(a,b){if(b.status==true){b.result.task.buttonType=
b.result.task.TASKRAY__List__c!=lastListColName?"Next":"None";if(currentBoardId=="my")b.result.smallPhotoUrl="";b.result.task.Name=wbr(b.result.task.Name,9);$j(taskCardTemplate(b.result)).prependTo("#column-"+defaultListIndex);updateSortOrdersForListWithNoMovement(defaultListIndex);refreshTasks()}if(b.type=="exception")if(b.message.indexOf("REQUIRED_FIELD_MISSING")!=-1){fieldName=b.message.replace(/.*\[/,"").replace(/\]/,"");advancedAddLightBox("Whoops! A required field is missing.")}else if(b.message.indexOf("Required FieldSets")!=
-1){fieldName=b.message.replace(/.*\:/,"");advancedAddLightBox("Whoops! A required field is missing.")}$j("#quick-add-text").val("");clearQuickAddLoadMask()});else 13==a.keyCode&&80>b.length&&(advancedAddLightBox(),$j("#quick-add-text").val(""))},5)});bindClickFunction($j(".action-bar-button"),function(){var a;a=$j(this).hasClass("active")?!1:!0;$j.cookie(columnList[$j(this).attr("id")],a,{expires:365,path:"/",secure:!0});setColumnView(function(){$j("#deadline-view").is(":visible")&&populateDeadlineView()})});
bindClickFunction($j(".nav-view-element"),function(){$j.cookie("bltr_view",$j(this).attr("id"),{expires:365,path:"/",secure:!0});setBoardView(function(a){"columns-view"==a&&(setColumnView(function(){}),refreshTasks());"deadline-view"==a&&(setColumnView(function(){}),populateDeadlineView());"planning-view"==a&&(setColumnView(function(){}),populatePlanningView())})});bindClickFunction($j("#deadline-btn"),function(){$j("#column-view").is(":visible")?(columnView=$j("#column-view").clone(),$j("#column-view").remove(),
$j("#deadline-view").toggle(),$j("#task-board").children().first().prepend(deadlineView)):(deadlineView=$j("#deadline-view").clone(),$j("#deadline-view").remove(),$j("#task-board").children().first().prepend(columnView))});bindClickFunction($j("#task-ray-preferences"),function(){$j("#preferences-frame").contents().empty();$j("#preferences-frame").attr("src",prefURL);$j("#preferences-modal").modal("show")});bindClickFunction($j("#my-notifications"),function(){$j("#notifications-frame").contents().empty();
$j("#notifications-frame").attr("src",myNotificationsURL);$j("#notifications-modal").modal("show")})}
function advancedAddLightBox(a,b){var c=null==b?trProjectTaskPage+"?controller=projecttask&editmode=true&quickadd=true&name="+encodeURIComponent($j("#quick-add-text").val()):trProjectTaskPage+"?Id="+b+"&controller=projecttask&editmode=true&name="+encodeURIComponent($j("#quick-add-text").val());$j("#quick-add-text").val("");"project"==currentBoardId?c+="&project="+$j(".project-select:not(.project-sidebar-inactive)").attr("id"):"group"==currentBoardId&&(c+="&project=groupboard");void 0!==a&&(c+="&message="+
encodeURIComponent(a));$j("#task-frame").contents().empty();$j("#task-frame").attr("src",c);$j("#task-modal").modal("show")}function planningAdvancedAddLightBox(a,b,c){a=trProjectTaskPage+"?controller=projecttask&editmode=true&quickadd=true&name="+encodeURIComponent($j(this).val());a+="&project="+b;void 0!==c&&(a+="&message="+encodeURIComponent(c));$j("#task-frame").contents().empty();$j("#task-frame").attr("src",a);$j("#task-modal").modal("show")}var viewAsSearchResultObjs={};
function attachMyBoardViewAs(){applyMyBoardViewAsChanges();$j("#view-as-input").typeahead({source:function(a,b){parent.TASKRAY.trController.searchUsers(a,function(a,d){var e=[];$j.each(d.result,function(a,b){b.Name=null!=b.UserRole&&null!=b.UserRole.Name?"<span><span>"+b.Name+" ("+b.UserRole.Name+")</span><span class='search-hidden'>"+b.Id+"</span></span>":"<span><span>"+b.Name+"</span><span class='search-hidden'>"+b.Id+"</span></span>";viewAsSearchResultObjs[b.Name]=b;e.push(b.Name)});b(e);this.source=
[]})},updater:function(a){o=viewAsSearchResultObjs[a];setViewAsUser(o.Id,o.SmallPhotoUrl);applyMyBoardViewAsChanges();initPage();return $j(o.Name).children(":first").text()},minLength:3});$j("#view-as-input").focus(function(){$j(this).val();$j(this).val("")})}
function applyMyBoardViewAsChanges(){addViewAsReset();$j(".display-unassigned-tasks").removeAttr("disabled");$j("#header").css("border","");$j(".pageType").html("TaskRay");currentUserId!=getViewAsUserId()?($j(".display-unassigned-tasks").attr("checked",!1),$j(".display-unassigned-tasks").attr("disabled",!0),$j("#header").css("border","4px solid #b94a48"),$j(".pageType").html('<span class="label label-important">Viewing the board of:</span>')):displayUnassignedTasks&&$j(".display-unassigned-tasks").attr("checked",
"checked")}function addViewAsReset(){$j("#view-as-reset").remove();currentUserId!=getViewAsUserId()&&($j("#view-as-input").after('<span id="view-as-reset" style="cursor: pointer; font-size: 13px;" class="add-on btn">Clear</span>'),bindClickFunction($j("#view-as-reset"),function(){setViewAsUser(currentUserId,null);$j("#view-as-input").val(currentUserFullName);applyMyBoardViewAsChanges();initPage()}))};function setColumnView(a){$j(".task-column").removeClass("left-most-column");0<listNameArr.length&&0==$j(".task-column").length&&populateColumns();$j.each(listNameArr,function(a){null==$j.cookie("bltr-column-visibility-"+a)?($j("#action-bar-button-column-"+a).addClass("active"),$j("#task-list-"+a).addClass("active-column")):"true"==$j.cookie("bltr-column-visibility-"+a)?($j("#action-bar-button-column-"+a).addClass("active"),$j("#task-list-"+a).alterClass("inactive-column","active-column")):($j("#action-bar-button-column-"+
a).removeClass("active"),$j("#task-list-"+a).alterClass("active-column","inactive-column"))});"deadline"==$j.cookie("bltr_view")?($j(".action-bar-button").removeClass("action-bar-button-disabled"),$j("#action-bar-button-column-"+(listNameArr.length-1)).removeClass("active"),$j("#action-bar-button-column-"+(listNameArr.length-1)).addClass("action-bar-button-disabled")):"planning"==$j.cookie("bltr_view")?($j(".action-bar-button").addClass("active"),$j(".action-bar-button").addClass("action-bar-button-disabled")):
$j(".action-bar-button").removeClass("action-bar-button-disabled");bindClickFunction($j(".action-bar-button"),function(){var a;a=$j(this).hasClass("active")?false:true;var c=$j(this).attr("id").replace("action-bar-button-column-","bltr-column-visibility-");$j.cookie(c,a,{expires:365,path:"/",secure:true});setColumnView(function(){$j("#deadline-view").is(":visible")&&populateDeadlineView()})});$j(".action-bar-button-disabled").unbind("click");setColumnWidths();"function"===typeof a&&a()}
function setColumnWidths(){if("columns"==$j.cookie("bltr_view")){var a=0;$j(".task-column:visible").each(function(){a+=$j(this).outerWidth(!0)});$j("#column-container").width(a)}}
function refreshColumnHeights(){var a=$j("#AppBodyHeader:visible").height()+$j(".bPageFooter").height()+$j("#taskboard-header").height(),a=$j(window).height()-a-140;$j(".sortable-list").css("height",a+"px");$j("#sidebar").css("height",a+25+"px");$j("#accordion2").css("max-height",a+41+"px");$j("#planning-view").css("height",a+41+"px")};function populateDeadlineView(){boardInfo=getBoardInfo();$j(".deadline-view-task").remove();TASKRAY.trController.fetchTasks_v2(boardInfo.boardParam,boardInfo.wherestr,getViewAsUserId(),function(a,b){!0==b.status&&($j(".deadline-view-task").remove(),tasks=[],sortkeys=[],$j.each(a,function(a,b){void 0==b.deadline&&(b.deadline=0);tasks.push(b);sortkeys.push(b.deadline)}),generateDeadlineList(tasks,sortkeys),attachDeadlineClickFunctions(),$j("#task-board").unmask(),$j("#canvasloader-container").hide(),
afterBoardChange())})}function attachDeadlineClickFunctions(){}
function generateDeadlineList(a){Date.prototype.getWeek=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil(((this-a)/864E5+a.getDay()+1)/7)};a.sort(function(a,b){return a.deadline<b.deadline?-1:a.deadline>b.deadline?1:a.sortOrder<b.sortOrder?-1:a.sortOrder>b.sortOrder?1:0});var b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate()),d=[];$j(".action-bar-button.active").each(function(){$j(this).attr("colnum")!=listNameArr.length-1&&d.push(listNameArr[$j(this).attr("colnum")])});
$j.each(a,function(a,b){utcDate=new Date(b.deadline);var g=new Date(utcDate.getUTCFullYear(),utcDate.getUTCMonth(),utcDate.getUTCDate());if(0!=b.deadline){b.display=-1!=$j.inArray(b.task.TASKRAY__List__c,d)?!0:!1;var j=$j.extend(!0,{},b);j.task.Name=wbr(j.task.Name,9);j.task.buttonType=j.task.TASKRAY__List__c!=lastListColName?"Next":"None";j.colNum=findListNameMapMatch(j.task.TASKRAY__List__c);var l=moment(c).day(1),h=moment(c).day(8);g<c?$j(taskCardTemplateDeadline(j)).appendTo("#overdue-row"):g.getTime()==
c.getTime()?$j(taskCardTemplateDeadline(j)).appendTo("#today-row"):l<=g&&g<h?$j(taskCardTemplateDeadline(j)).appendTo("#week-row"):g>c&&$j(taskCardTemplateDeadline(j)).appendTo("#later-row")}});updateDeadlineCounts()}
function updateDeadlineCounts(){var a={};$j.each(["overdue","today","week","later"],function(b,c){a[c]=$j("#deadline-view-"+c).children().find(".deadline-view-task:visible").length});$j.each(a,function(a,c){0<c?$j("#deadline-header-count-"+a).html(c).show():$j("#deadline-header-count-"+a).hide()})};var tzOffsetInMS=6E4*(new Date).getTimezoneOffset(),planningViewLastEditedItem=null;
function populatePlanningView(){$j("#task-board").unmask();$j("#canvasloader-container").hide();maskPlanningView();getSideBarUsersPhotos();boardInfo=getBoardInfo();0==boardInfo.projectIds.length?(emptyPlanningView(),$j("#planning-view").unmask()):TASKRAY.trController.fetchPlanningView_v2(boardInfo.boardParam,boardInfo.projectIds,getViewAsUserId(),function(a,b){parsedResults=[];if(!0==b.status){var c=(new Date).getTime(),d=new Date;d.setDate(d.getDate()+60);var e=d.getTime();$j.each(a,function(a,b){var d=
{};d.itemType=b.itemType;var l="",h="",m=!1,k=!1;"undefined"===typeof b.project.TASKRAY__Project_Start__c&&(m=!0);"undefined"===typeof b.project.TASKRAY__Project_End__c&&(k=!0);!1==m&&!1==k?(l=b.project.TASKRAY__Project_Start__c,h=b.project.TASKRAY__Project_End__c):!0==m&&!0==k?(l=c,h=e):!0==m&&!1==k?(l=new Date,l.setTime(b.project.TASKRAY__Project_End__c),l.setDate(l.getDate()-30),l=l.getTime(),h=b.project.TASKRAY__Project_End__c):!1==m&&!0==k&&(h=new Date,h.setTime(b.project.TASKRAY__Project_Start__c),
h.setDate(h.getDate()+60),l=b.project.TASKRAY__Project_Start__c,h=h.getTime());m="undefined"===typeof b.project.TASKRAY__Project_Start__c||"undefined"===typeof b.project.TASKRAY__Project_End__c?!0:!1;if("project"==b.itemType){d.name=b.itemName;d.from_int=m?9007199254740992:parseInt(l);var m=m?"planning-view-unassigned-project":"planning-view-project",k=new Date(h),p=new Date(l);13<k.getHours()&&k.dst()&&!p.dst()&&(h=k.setDate(k.getDate()+1));d.values=[{from:"/Date("+l+")/",to:"/Date("+h+")/",label:"",
customClass:m,dataObj:{useParent:!0,Id:b.project.Id,parentId:b.project.TASKRAY__Project_Parent__c,parentName:"parentName",sortOrder:"usealpha",bgColor:"#B0B0B0",textColor:getContrastYIQ(b.project.TASKRAY__ProjectColor__c),itemType:b.itemType,taskCounts:b.taskCounts,ownerInfo:b.ownerInfo}}]}else if("task"==b.itemType){d.name=b.itemName;k="undefined"===typeof b.projectTask.TASKRAY__Deadline__c?null:b.projectTask.TASKRAY__Deadline__c;p="undefined"===typeof b.projectTask.TASKRAY__List__c?null:b.projectTask.TASKRAY__List__c;
null!=k&&(h=l=k);m=null==k?"planning-view-unassigned-task":"planning-view-task";bgColor="transparent";var q=null!=k&&(new Date).getTime()-tzOffsetInMS>k&&findListNameMapMatch(p)!=listNameArr.length-1?!0:!1;q&&(bgColor="#eeb3b2");d.from_int=null==k?9007199254740992:parseInt(l);d.sortOrder=b.projectTask.SortOrder__c;d.values=[{from:"/Date("+l+")/",to:"/Date("+h+")/",label:"",customClass:m,dataObj:{useParent:!0,Id:b.projectTask.Id,parentId:b.project.Id,parentName:b.project.Name,bgColor:bgColor,textColor:getContrastYIQ(b.project.TASKRAY__ProjectColor__c),
itemType:b.itemType,taskList:p,overdue:q,ownerInfo:b.ownerInfo}}]}parsedResults.push(d)});sorted=sortPlanningView(parsedResults);quickAddInserted=[];$j.each(sorted,function(a,b){quickAddInserted.push(b);if("project"==b.values[0].dataObj.itemType){var c={itemType:"quickAdd",name:"quickAddPlaceholder"};c.from_int=b.from_int;c.values=[{from:b.values[0].from,to:b.values[0].to,label:"",customClass:"quick-add-placeholder",dataObj:{useParent:!0,Id:"quick-add-"+b.values[0].dataObj.Id,parentId:b.values[0].dataObj.Id,
sortOrder:"usealpha",bgColor:"transparent",textColor:"white",itemType:"quickAdd",hierarchyLevel:b.values[0].dataObj.hierarchyLevel+1}}];quickAddInserted.push(c)}})}populateGanttChart(quickAddInserted)})}
function sortPlanningView(a){var b=[],c=[],d={};$j.each(a,function(a,e){"project"==e.itemType?(c.push(e),b.push(e.values[0].dataObj.Id)):"task"==e.itemType&&("undefined"===typeof d[e.values[0].dataObj.parentId]&&(d[e.values[0].dataObj.parentId]=[]),d[e.values[0].dataObj.parentId].push(e))});sortedProjects=sortPlanningView_projects(c,b);var e=[];$j.each(sortedProjects,function(a,b){e.push(b);var c=b.values[0].dataObj.Id;taskArr=null!=d[c]?d[c]:null;null!=taskArr&&(taskArr.sort(planningView_tasksort),
$j.each(taskArr,function(a,c){c.values[0].dataObj.hierarchyLevel=b.values[0].dataObj.hierarchyLevel+1}),e=e.concat(taskArr))});return e}function planningView_tasksort(a,b){return a.from_int>b.from_int?1:a.from_int<b.from_int||a.sortOrder<b.sortOrder?-1:a.sortOrder>b.sortOrder?1:a.name<b.name?-1:a.name>b.name?1:0}
function sortPlanningView_projects(a,b){a.sort(function(a,b){return a.from_int>b.from_int?1:a.from_int<b.from_int?-1:a.name<b.name?-1:a.name>b.name?1:0});var c=[],d=planningViewProjectMapper(c),e=[];$j.each(a,function(a,d){var f=d.values[0].dataObj.parentId;if(-1===$j.inArray(f,b)||null==f)return d.values[0].dataObj.hierarchyLevel=0,c.push(d),e.push(a),!0});$j.each(e.reverse(),function(b,c){a.splice(c,1)});for(var e=[],a=a.reverse(),f=0;5>f;f++)$j.each(a,function(a,b){blanketObj=planningViewProjectMapper(c);
d=blanketObj.returnObj;sortedArr=blanketObj.returnArr;var f=b.values[0].dataObj.parentId;if(-1!==$j.inArray(f,sortedArr))return b.values[0].dataObj.hierarchyLevel=c[d[f]].values[0].dataObj.hierarchyLevel+1,c.splice(d[f]+1,0,b),e.push(a),!0}),$j.each(e.reverse(),function(b,c){a.splice(c,1)}),e=[];return c}
function planningViewProjectMapper(a){var b={},c={},d=[];$j.each(a,function(a,b){null!=b.values[0].dataObj.Id&&(c[b.values[0].dataObj.Id]=a,d.push(b.values[0].dataObj.Id))});b.returnObj=c;b.returnArr=d;return b}function emptyPlanningView(){$j("#planning-view #gantt-chart").empty()}var planningViewCurrentZoomLevel="days";
function populateGanttChart(a){$j("#gantt-chart").gantt({source:a,navigate:"scrollOnly",scale:planningViewCurrentZoomLevel,maxScale:"months",minScale:"days",itemsPerPage:99999999999999,onItemClick:function(){},onAddClick:function(){},onRender:function(){fixGanttChart();$j("#planning-view").unmask();$j("#planning-view").trigger("scroll");afterBoardChange()},useCookie:!0})}var sessionHorizScroll=null;
function fixGanttChart(){$j(".rightPanel .row").wrapAll('<div id="planning-view-wrapped-header" />');$j(".row.spacer").append($j(".row.spacer").clone().addClass("spacer-absolute"));$j("#planning-view-wrapped-header").css("margin-top",$j("#planning-view").scrollTop());$j("#planning-view").scroll(function(){var a=$j(this).scrollTop();$j("#planning-view-wrapped-header").css("margin-top",a);$j(".row.spacer.spacer-absolute").css("margin-top",a);$j("#planning-view .leftPanel").css("left",$j(this).scrollLeft()+
"px");sessionHorizScroll=$j(this).scrollLeft()});$j("#planning-view").trigger("scroll");$j("#quick-add-text-wrapper .navigate").remove();$j("#quick-add-text-wrapper .input-append").hide();$j("#quick-add-text-wrapper").addClass("fn-gantt");$j("#gantt-chart .fn-gantt .navigate").appendTo($j("#quick-add-text-wrapper"));$j(".nav-slider-content").remove();$j(".nav-slider-left span.nav-now i").remove();$j(".nav-slider-left span.nav-now").text(labels.TaskRay_PlanView_TodayButton);$j(".nav-slider-left span.nav-now").css("color",
"#333333");$j(".nav-slider-left span.nav-now").css("font-size","12px");$j(".nav-slider-left span.nav-now").css("font-weight","bold");$j(".nav-slider-left span.nav-now").css("padding-bottom","2px");$j(".nav-slider-left span.nav-now").css("padding-top","2px");$j(".navigate .nav-now").attr("title",labels.TaskRay_PlanView_TodayButtonHover);$j(".navigate .nav-zoomIn").attr("title",labels.TaskRay_PlanView_ZoomInHover);$j(".navigate .nav-zoomOut").attr("title",labels.TaskRay_PlanView_ZoomOutHover);bindClickFunction($j(".navigate .nav-now"),
function(a){a.preventDefault();planningViewHorizontalScrollToToday()});$j(".rightPanel .bar").each(function(a,b){dataObj=$j(b).data().dataObj;var c=dataObj.taskList?"planning-view-list-"+findListNameMapMatch(dataObj.taskList):"";paddingAmt=5*dataObj.hierarchyLevel;lineId=$j(b).attr("lineid");$j(b).attr("itemtype",dataObj.itemType);$j(".leftPanel .node-"+lineId+" .fn-label").css("padding-left",paddingAmt);"project"==dataObj.itemType?$j(".leftPanel .node-"+lineId+" .fn-label").css("width",205-paddingAmt):
$j(".leftPanel .node-"+lineId+" .fn-label").css("width",210-paddingAmt);$j(".leftPanel .node-"+lineId+" .fn-label").attr("title",$j(".leftPanel .node-"+lineId+" .fn-label").text());$j(".leftPanel .node-"+lineId).attr("itemtype",dataObj.itemType);$j(".leftPanel .node-"+lineId).attr("lineid",lineId);$j(b).hasClass("planning-view-unassigned-project")?($j(".leftPanel .node-"+lineId).addClass("planning-view-unassigned-project"),$j(".leftPanel .node-"+lineId+" .fn-label").append('<i class="icon-calendar planning-view-unassigned-project-drag" itemtype="'+
dataObj.itemType+'" itemid="'+lineId+'"></i>')):$j(b).hasClass("planning-view-unassigned-task")?($j(".leftPanel .node-"+lineId).addClass("planning-view-unassigned-task"),$j(".leftPanel .node-"+lineId).addClass("planning-view-task-label"),$j(".leftPanel .node-"+lineId+" .fn-label").append('<a href="" class="halflings map-marker planning-view-unassigned-task-drag '+c+'" itemtype="'+dataObj.itemType+'" itemid="'+lineId+'" ><i></i></a>')):$j(b).hasClass("planning-view-task")&&($j(".leftPanel .node-"+
lineId).addClass("planning-view-task-label"),$j(b).children(".fn-label").addClass("planning-view-overdue-task-bg").css("background-color",dataObj.bgColor).append('<a href="" class="halflings map-marker planning-view-task-drag '+c+'" itemtype="'+dataObj.itemType+'" itemid="'+lineId+'" ><i></i></a>'));"project"==dataObj.itemType&&!$j(".leftPanel .node-"+lineId).hasClass("planning-view-unassigned-project")&&$j(".leftPanel .node-"+lineId+" .fn-label").append('<a href="" class="halflings chevron-right planning-view-goto-item '+
c+'" itemtype="'+dataObj.itemType+'" itemid="'+lineId+'"  title="Go To Project"><i></i></a>');"task"==dataObj.itemType&&!$j(".leftPanel .node-"+lineId).hasClass("planning-view-unassigned-task")&&$j(".leftPanel .node-"+lineId+" .fn-label").append('<a href="" class="halflings chevron-right planning-view-goto-item" itemtype="'+dataObj.itemType+'" itemid="'+lineId+'" title="Go To Task"><i></i></a>');hasChildren=0<$j(".child-of-node-"+lineId).length?!0:!1;"project"==dataObj.itemType&&hasChildren?($j(".leftPanel .node-"+
lineId+" .fn-label").css("padding-left","0"),$j(".leftPanel .node-"+lineId+" .fn-label").prepend('<a href="" class="halflings plus expand-project" style="display:none;padding-left:'+paddingAmt+'px;"><i></i></a>'),$j(".leftPanel .node-"+lineId+" .fn-label").prepend('<a href="" class="halflings minus collapse-project" style="padding-left:'+paddingAmt+'px;"><i style="left:'+paddingAmt+'px;"></i></a>')):$j(".leftPanel .node-"+lineId+" .fn-label").prepend('<i class="icon-minus collapse-placeholder" style="visibility:hidden;"></i>');
"project"==dataObj.itemType?applyProjectBarStyling(b,dataObj):"task"==dataObj.itemType&&(dataObj.ownerInfo?$j(".leftPanel .node-"+lineId+" .fn-label").prepend($j('<img title="'+dataObj.ownerInfo.Name+'" width="18" height="18" src="'+dataObj.ownerInfo.SmallPhotoUrl+'" />')):$j(".leftPanel .node-"+lineId+" .fn-label").prepend($j('<img  width="18" height="18" src="/s.gif" />')))});$j('.leftPanel div[itemtype="quickAdd"] .fn-label').html('<i class="icon-minus collapse-placeholder" style="visibility:hidden;"></i><input class="planning-quick-add" type="text" title="'+
labels.TaskRay_PlanView_AddATaskPlaceholder+'" placeholder="'+labels.TaskRay_PlanView_AddATaskPlaceholder+'" />');$j('.leftPanel div[itemtype="quickAdd"] .fn-label input').each(function(){$j(this).attr("style","width:"+($j(this).parent().width()-36)+"px !important")});bindClickFunction($j('#gantt-chart .fn-gantt .leftPanel .name[itemtype="project"]'),function(a){a.preventDefault();a.stopPropagation();$j(this).find(".collapse-project").is(":visible")?($j(this).find(".collapse-project").hide(),$j(this).find(".collapse-project").siblings(".expand-project").show(),
id=$j(this).attr("lineid"),collapseOrExpandPlanningTree(id,"collapse")):($j(this).find(".expand-project").hide(),$j(this).find(".expand-project").siblings(".collapse-project").show(),id=$j(this).attr("lineid"),collapseOrExpandPlanningTree(id,"expand"))});getDateXAxisMap();applyPlanningViewDroppables();applyPlanningViewDraggables();applyPlanningViewProjectResize();attachPlanningQuickAdd();collapsePlanningTreeAll();applyPersistedExpands();bindClickFunction($j('#gantt-chart .fn-gantt .bar, #gantt-chart .fn-gantt .leftPanel .name[itemtype!="project"]'),
function(a){a.preventDefault();$j(a.target).is(".expand-project, .collapse-project, .ui-resizable-handle")||("task"==$j(this).attr("itemtype")&&showProjectTaskModal($j(this).attr("lineid")),"project"==$j(this).attr("itemtype")&&showProjectModal($j(this).attr("lineid")))});bindClickFunction($j("#gantt-chart .fn-gantt .leftPanel .planning-view-goto-item"),function(a){a.preventDefault();a.stopPropagation();planningViewScrollToItem($j(this).attr("itemid"))});$j("#gantt-chart").width($j("#gantt-chart .leftPanel").width()+
$j("#gantt-chart .rightPanel .dataPanel").width());applyPersistedScroll()}
function applyPersistedScroll(){if(null!=planningViewLastEditedItem&&0!=$j(".node-"+planningViewLastEditedItem).length){var a=$j(".node-"+planningViewLastEditedItem),b=!0;if($j("#planning-view").scrollTop()+$j("#planning-view-wrapped-header").height()>$j(a).position().top||$j("#planning-view").scrollTop()+$j("#planning-view").height()-scrollbarWidth<$j(a).position().top+$j(a).height())b=!1;b||($j("#planning-view").scrollTop($j(a).position().top-$j("#planning-view-wrapped-header").height()),!$j(a).hasClass("planning-view-unassigned-task")&&
!$j(a).hasClass("planning-view-unassigned-project")?$j("#planning-view").scrollLeft(parseFloat($j(".node-"+planningViewLastEditedItem+".bar").css("margin-left"))):null!=sessionHorizScroll?$j("#planning-view").scrollLeft(sessionHorizScroll):planningViewHorizontalScrollToToday());null!=sessionHorizScroll?$j("#planning-view").scrollLeft(sessionHorizScroll):planningViewHorizontalScrollToToday();$j("#planning-view").trigger("scroll");$j(".leftPanel .node-"+planningViewLastEditedItem).css("background-color",
"");$j(".leftPanel .node-"+planningViewLastEditedItem).effect("highlight",{},6E3);planningViewLastEditedItem=null}else null!=sessionHorizScroll?$j("#planning-view").scrollLeft(sessionHorizScroll):planningViewHorizontalScrollToToday();$j("#planning-view").trigger("scroll")}
function applyPersistedExpands(){var a=$j.cookie("bltr_planning_view_expanded");isValidJSON(a)&&(a=JSON.parse(a));tempExpandedItems=$j.extend([],a);for(var b={},a=0;7>a;a++)$j.each(tempExpandedItems,function(a,d){$j(".node-"+d+".row").is(":visible")&&!0!=b[$j(".node-"+d+".row").attr("id")]&&($j(".node-"+d+".row").trigger("click"),b[$j(".node-"+d+".row").attr("id")]=!0)})}
function attachPlanningQuickAdd(){bindKeypressFunction($j(".planning-quick-add"),function(a){13==a.keyCode&&a.preventDefault();var b=$j(this).val(),c=$j(this).parents(".row").attr("lineid").replace("quick-add-","");13==a.keyCode&&80>b.length&&currentUserId==getViewAsUserId()?0==b.length?alert("Cannot add a blank task! (Well, we can, but you probably don't want to.)"):TASKRAY.trController.addTask(b,c,function(a,e){!0==e.status&&(planningViewLastEditedItem=e.result.task.Id,populatePlanningView());"exception"==
e.type&&(-1!=e.message.indexOf("REQUIRED_FIELD_MISSING")?(fieldName=e.message.replace(/.*\[/,"").replace(/\]/,""),planningAdvancedAddLightBox(b,c,"Whoops! A required field is missing.")):-1!=e.message.indexOf("Required FieldSets")?(fieldName=e.message.replace(/.*\:/,""),planningAdvancedAddLightBox(b,c,"Whoops! A required field is missing.")):(parsedMsg=e.message.replace(/.*First\sexception.*first\serror\:\s\w*,/,""),planningAdvancedAddLightBox(b,c,parsedMsg+"<br />Whoops! TaskRay could not add this task. Check for any required fields or validation rules.")));
$j(this).val("")}):13==a.keyCode&&80>b.length&&(planningAdvancedAddLightBox(b,c),$j(this).val(""))})}
function applyProjectBarStyling(a,b){if(null!=b.taskCounts){$j(a).css("background-color","#B0B0B0");var c=b.taskCounts.total,d={},e=0;$j.each(listNameArr,function(f,g){d[g]=null!=b.taskCounts[g]?100*(b.taskCounts[g]/c):0;if(0<d[g]){var j=1==b.taskCounts[g]?"Task":"Tasks";$j(a).append('<div title="'+b.taskCounts[g]+" "+j+" in "+g+'" class="progress-div progress-div-'+findListNameMapMatch(g)+'" style="width:'+d[g]+"%;margin-left:"+e+'%"><span class="progress-div-text">'+b.taskCounts[g]+"</span></div>")}e+=
d[g]})}$j(a).children(".fn-label").css("position","absolute");$j(a).children(".progress-div:first").addClass("progress-div-left");$j(a).children(".progress-div:last").addClass("progress-div-right")}
function applyPlanningViewProjectResize(){$j(".planning-view-project").resizable({handles:"e, w",resize:function(a,b){b.size.height=b.originalSize.height},start:function(a,b){$j(".leftPanel .node-"+$j(b.element).attr("lineid")+"").css("background-color","#FEFE9A")},stop:function(a,b){var c=findDateFromXAxisMap($j(this).offset().left),d=findDateFromXAxisMap($j(this).offset().left+$j(this).width());updatePlanningViewDates("project",$j(b.element).attr("lineid"),c,d)}})}planningViewXAxisMap=[];
initialMarginLeft=0;function getDateXAxisMap(){initialMarginLeft=0;planningViewXAxisMap=[];$j(".day").each(function(){planningViewXAxisMap.push({date:$j(this).attr("repdate"),leftSide:$j(this).position().left,rightSide:$j(this).position().left+$j(this).width()})})}
function findDateFromXAxisMap(a){var b=null;leftSidebarMargin=235;currentScroll=$j("#planning-view").scrollLeft();var c=a+currentScroll-leftSidebarMargin;len=planningViewXAxisMap.length;$j.each(planningViewXAxisMap,function(a,e){if(e.leftSide<=c&&e.rightSide>=c||a==len-1)return b=e.date,!1});tzAdd=-6E4*(new Date).getTimezoneOffset();return b=parseInt(b)+parseInt(tzAdd)}
function applyPlanningViewDroppables(){$j("body").droppable({accept:function(a){var a=$j(a).offset().left,b=$j(".dataPanel").position().left,c=$j(".dataPanel").position().left+$j(".dataPanel").width();if(b<a&&a<c)return!0},drop:function(a,b){dateDroppedOn=findDateFromXAxisMap($j(b.draggable).offset().left+$j(b.draggable).width()/2);!$j(b.draggable).hasClass("project-select")&&!$j(b.draggable).hasClass("projmem-drag")&&updatePlanningViewDates($j(b.draggable).attr("itemtype"),$j(b.draggable).attr("itemid"),
dateDroppedOn)}})}function updatePlanningViewDates(a,b,c,d){null==d&&(d=c);if(!(c>d)){var e=0!=$j('.planning-view-unassigned-task-drag[itemid="'+b+'"]').length?!0:!1;"task"==a&&!e?reorderPlanningViewItem(b,c,d):maskPlanningView("changes");TASKRAY.trController.updatePlanningViewItemDates_v2(a,b,c,d,function(c,d){!0==d.status&&(planningViewLastEditedItem=b,("task"!=a||e)&&populatePlanningView())})}}
function applyPlanningViewDraggables(){$j(".planning-view-unassigned-task-drag, .planning-view-unassigned-project-drag").draggable({axis:"x",revert:"invalid",start:function(a,b){$j("#planning-view").scrollLeft($j("#planning-view").scrollLeft());$j(".leftPanel .node-"+$j(b.helper).attr("itemid")+"").css("background-color","#FEFE9A")},stop:function(){},appendTo:"#planning-view"});$j(".planning-view-task-drag").draggable({axis:"x",revert:"invalid",start:function(a,b){$j("#planning-view").scrollLeft($j("#planning-view").scrollLeft());
$j(".leftPanel .node-"+$j(b.helper).attr("itemid")+"").css("background-color","#FEFE9A")},stop:function(){},appendTo:"#planning-view",grid:[24,24]})}
function collapseOrExpandPlanningTree(a,b){idsToHide={};idsToHide[a]=a;for(var c={},d=0;7>d;d++)$j.each(idsToHide,function(a,b){$j(".child-of-node-"+b).each(function(){idsToHide[$j(this).attr("lineid")]=$j(this).attr("lineid");"project"==$j(this).attr("itemtype")&&(c[$j(this).attr("lineid")]=$j(this).attr("lineid"))})});idArrToHide=[];$j.each(idsToHide,function(c){a!=c&&("expand"==b?$j('.fn-gantt div[lineid="'+c+'"]').hasClass("child-of-node-"+a)&&idArrToHide.push('.fn-gantt div[lineid="'+c+'"]'):
idArrToHide.push('.fn-gantt div[lineid="'+c+'"]'))});"expand"==b?($j(idArrToHide.join()).show(),$j.each(c,function(a){$j('.fn-gantt .leftPanel div[lineid="'+a+'"] .minus').hide();$j('.fn-gantt .leftPanel div[lineid="'+a+'"] .plus').show()})):"collapse"==b&&($j(idArrToHide.join()).hide(),$j.each(c,function(a){$j('.fn-gantt .leftPanel div[lineid="'+a+'"] .minus').hide();$j('.fn-gantt .leftPanel div[lineid="'+a+'"] .plus').show()}));recalculatePlanningViewBarLayout();$j.cookie("bltr_planning_view_expanded",
"");var e=[];$j("#planning-view .leftPanel .collapse-project:visible").each(function(){e.push($j(this).parents(".row").attr("lineid"))});$j.cookie("bltr_planning_view_expanded",JSON.stringify(e))}
function collapsePlanningTreeAll(){idsToHide={};parentIdsToHide={};$j(".leftPanel .row .collapse-project:visible").each(function(){parentIdsToHide[$j(this).parents(".row").attr("lineid")]=$j(this).parents(".row").attr("lineid");$j(this).hide();$j(this).siblings(".expand-project").show()});for(var a=0;7>a;a++)$j.each(parentIdsToHide,function(a,c){$j(".child-of-node-"+c).each(function(){idsToHide[$j(this).attr("lineid")]=$j(this).attr("lineid")})});idArrToHide=[];$j.each(idsToHide,function(a){idArrToHide.push('.fn-gantt div[lineid="'+
a+'"]')});$j(idArrToHide.join()).hide();recalculatePlanningViewBarLayout()}function recalculatePlanningViewBarLayout(){var a=$j(".leftPanel .spacer").height()+2;$j(".dataPanel .bar:visible").each(function(b,c){newMarginTop=a+24*b;$j(c).css("margin-top",newMarginTop)});$j(".rightPanel").height($j(".leftPanel").height())}
function planningViewHorizontalScrollToToday(){0!==$j("#planning-view-wrapped-header .today").length&&$j("#planning-view").scrollLeft($j("#planning-view-wrapped-header .today").position().left)}
function maskPlanningView(a){"changes"==a?($j("#planning-view").mask("Loading your change..."),$j(".ui-widget-content").css("min-width","180px")):$j("#planning-view").isMasked()||$j("#planning-view").mask("Loading...");$j(".ui-widget-overlay").css("margin-left",$j("#planning-view").scrollLeft());$j(".ui-widget-overlay").css("margin-top",$j("#planning-view").scrollTop());$j(".ui-widget-content").css("margin-top",$j("#planning-view").scrollTop());$j(".ui-widget-content").css("margin-left",$j("#planning-view").scrollLeft());
$j(".ui-overlay-loading").parent().css("z-index","1500");$j(".ui-overlay-loading").css("font-size","12px;")}
function reorderPlanningViewItem(a){var b=$j('#planning-view .bar[lineid="'+a+'"]'),c=$j('#planning-view .bar[lineid="'+a+'"] .map-marker');if(0==c.length)populatePlanningView();else{var d=24*Math.round($j(c).position().left/24),e=parseFloat($j(b).css("margin-left")),f=$j('#planning-view .leftPanel .row[lineid="'+a+'"]'),g=f.index()+1,j="",f=$j(b).attr("class").split(/\s+/);$j.each(f,function(a,b){-1!==b.indexOf("child-of-node-")&&(j=b)});var l=e+d,h=[];$j("#planning-view .bar."+j+".planning-view-task:visible").each(function(){var a=
{lineid:$j(this).attr("lineid"),margin_left:parseFloat($j(this).css("margin-left")),margin_top:parseFloat($j(this).css("margin-top"))};h.push(a)});$j(b).css("margin-left",l+"px");$j(c).css("left","4px");h.sort(function(a,b){return a.margin_left<b.margin_left?-1:a.margin_left>b.margin_left?1:0});var m="",k=h[0].margin_left,p="",q="",t="",u=!1,v=!1,n=!1;$j.each(h,function(b,c){var d=c.margin_left;c.lineid==a&&(t=b,q=c.margin_top);d>l&&k<=l||0==b&&l<=k?(b==t+1&&(v=!0),n=!0,m=c.lineid,p=c.margin_top):
b==h.length-1&&!1==n&&(u=!0,m=c.lineid,p=c.margin_top);k=d});if(p!=q){f=$j('#planning-view .leftPanel .row[lineid="'+a+'"]');u?($j(b).insertAfter('#planning-view .bar[lineid="'+m+'"]'),$j(f).insertAfter($j('#planning-view .leftPanel .row[lineid="'+m+'"]')),$j(b).css("margin-top",p+24)):($j(b).insertBefore('#planning-view .bar[lineid="'+m+'"]'),$j(f).insertBefore($j('#planning-view .leftPanel .row[lineid="'+m+'"]')),v&&(p-=24),$j(b).css("margin-top",p));var b=$j(f).index()+1,s=[],r=!1;$j.each($j("#planning-view .leftPanel .row"),
function(){if($j(this).attr("lineid")==m||r){r=true;dataObj={"margin-top":$j(this).css("margin_top"),lineid:$j(this).attr("lineid")};s.push(dataObj);var a=$j(this).attr("margin-top");$j(this).attr("margin-top",a+24)}});fixPlanningViewMarginTops(g,b,a)}planningViewLastEditedItem=a;checkPlanningViewBarOverdueColor(a);applyPersistedScroll()}}
function fixPlanningViewMarginTops(a,b){var c=$j("#planning-view .leftPanel .row");if(a<b)for(i=a;i<=b;i++){var d=$j(c[i]).attr("lineid"),d=$j('#planning-view .bar[lineid="'+d+'"]');currentMarginTop=parseFloat($j(d).css("margin-top"));$j(d).css("margin-top",currentMarginTop-24)}else if(a>b)for(i=b+1;i<=a;i++)d=$j(c[i]).attr("lineid"),d=$j('#planning-view .bar[lineid="'+d+'"]'),currentMarginTop=parseFloat($j(d).css("margin-top")),$j(d).css("margin-top",currentMarginTop+24)}
function checkPlanningViewBarOverdueColor(a){var b=parseFloat($j('.planning-view-task-drag[itemid="'+a+'"]').parents(".bar").css("margin-left")),c=0;0!==$j(".today").length?c=$j(".today").position().left:(c=$j("#planning-view-wrapped-header .row:last").attr("repdate"),epochNow=(new Date).getTime(),c=epochNow>c?$j("#planning-view-wrapped-header .row:last").position().left:$j("#planning-view-wrapped-header .row:first").position().left);b<=c&&!$j('.planning-view-task-drag[itemid="'+a+'"]').hasClass("planning-view-list-"+
(listNameArr.length-1))?($j('.planning-view-task-drag[itemid="'+a+'"]').parents(".bar").css("background-color","#EEB3B2"),$j('.planning-view-task-drag[itemid="'+a+'"]').parents(".fn-label").css("background-color","#EEB3B2")):($j('.planning-view-task-drag[itemid="'+a+'"]').parents(".bar").css("background-color","transparent"),$j('.planning-view-task-drag[itemid="'+a+'"]').parents(".fn-label").css("background-color","transparent"))}
function planningViewScrollToItem(a){a=parseFloat($j('#planning-view .bar[lineid="'+a+'"]').css("margin-left"));$j("#planning-view").scrollLeft(a)};function checkFeedNotifications(a){var b={},c=null!=a.LastVisit?a.LastVisit:0,d=0,e=0;null!=a.feeds&&$j.each(a.feeds,function(a,b){b.CreatedDate>c&&d++;null!=b.FeedComments&&$j.each(b.FeedComments,function(a,b){b.CreatedDate>c&&d++});("ContentPost"==b.Type||"LinkPost"==b.Type)&&e++});b.ContentPosts=e;b.newFeedItems=d;return b}
function updateTaskAnimate(a,b,c){skipPoll=!0;c?$j("#"+a).effect("bounce",200,function(){cleanAnimationWrappers();$j(this).remove();skipPoll=!1;setTimeout(function(){cleanAnimationWrappers()},800)}):$j("#"+a).effect("bounce",200,function(){cleanAnimationWrappers();skipPoll=!1;setTimeout(function(){cleanAnimationWrappers()},800)})}
function updateTaskAnimate_bulk(a,b,c){skipPoll=!0;c?$j("#"+a.join(",#")).effect("bounce",200,function(){cleanAnimationWrappers();$j(this).remove();skipPoll=!1;setTimeout(function(){cleanAnimationWrappers()},800)}):$j("#"+a.join(",#")).effect("bounce",200,function(){cleanAnimationWrappers();skipPoll=!1;setTimeout(function(){cleanAnimationWrappers()},800)})}function cleanAnimationWrappers(){$j(".ui-effects-wrapper").each(function(){""==$j(this).html()&&$j(this).remove()})}
function getLightboxDims(a,b,c){var d=$j(window).height(),e=$j(window).width(),f=Math.max(a[0]/100*$j(window).width(),b[0]);0!=c[0]&&(f=Math.min(f,c[0]));a=Math.max(a[1]/100*$j(window).height(),b[1]);0!=c[1]&&(a=Math.min(a,c[1]));c=[e/2-f/2,0+(d/2-a/2)];return{x:c[0],y:c[1],width:f,height:a}}function bindClickFunction(a,b){$j(a).unbind("click");$j(a).bind("click",b)}function bindKeypressFunction(a,b){$j(a).unbind("keydown");$j(a).bind("keydown",b)}
function hideSetupWizard(a){a||(a=!1);TASKRAY.trController.hideSetupWizard(function(a,c){!0==c.status&&(location.href.split("?"),$j("#setup-wizard-modal").modal("hide"))})}function toggleDisplayUnassignedTasks(){TASKRAY.trController.toggleDisplayUnassignedTasks(function(){})}function showMaskMessage(a,b,c,d){$j(b).addClass(c);$j(b).mask(a);0<d&&setTimeout(function(){$j(b).unmask();$j(b).removeClass(c)},d)}
function muteColor(a){a=a.split("");switch(a.length){case 3:a=[a[0],a[0],a[1],a[1],a[2],a[2]];break;case 4:a=[a[1],a[1],a[2],a[2],a[3],a[3]];break;case 6:a=[a[0],a[1],a[2],a[3],a[4],a[5]];break;case 7:a=[a[1],a[2],a[3],a[4],a[5],a[6]];break;default:return alert("Error in function muteColor: Color not of a known format."),"#fff"}for(var b=0;6>b;b++){switch(a[b].toLowerCase()){case "a":a[b]=10;break;case "b":a[b]=11;break;case "c":a[b]=12;break;case "d":a[b]=13;break;case "e":a[b]=14;break;case "f":a[b]=
15}a[b]=parseInt(a[b])}a=[16*a[0]+a[1],16*a[2]+a[3],16*a[4]+a[5]];for(b=0;3>b;b++)a[b]=parseInt(a[b])+100;return"rgb("+a[0]+","+a[1]+","+a[2]+")"}function getSmallPhotoUrl(a,b){pcColumnController.getNewOwnerSmallPhotoUrl(a,function(a,d){$j("#"+b).find("img").attr("src",d.result)},{escape:!0})}
function GetUrlArguments(){for(var a={},b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=window.location.search.substring(1);b=d.exec(e);)a[decodeURIComponent(b[1].replace(c," "))]=decodeURIComponent(b[2].replace(c," "));return a}function datePassed(a){a=a.split("-");return new Date>new Date(a[0],a[1]-1,a[2],0,0,0)}function addQuickAddLoadMask(){$j("#quick-add-text").css("background","url('"+ajaxLoaderCircleURL+"') no-repeat right center").attr("disabled","disabled")}
function clearQuickAddLoadMask(){$j("#quick-add-text").removeAttr("disabled").css("background","")}function editProjectSaveCallback(){}Object.equals=function(a,b){if(a===b)return!0;if(!(a instanceof Object)||!(b instanceof Object)||a.constructor!==b.constructor)return!1;for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]&&("object"!==typeof a[c]||!Object.equals(a[c],b[c]))))return!1;for(c in b)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(c))return!1;return!0};
(function(a){a.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()}})(jQuery);(function(a){a.objectDiff=function(b,c,d){d={};a.each([b,c],function(e,f){for(prop in f)f.hasOwnProperty(prop)&&("object"===typeof f[prop]?d[prop]=a.objectDiff(b[prop],c[prop],d):b[prop]!=c[prop]&&(d[prop]=[b[prop],c[prop]]))});return d}})(jQuery);
(function(a){a.fn.alterClass=function(b,c){if(-1===b.indexOf("*"))return this.removeClass(b),!c?this:this.addClass(c);var d=RegExp("\\s"+b.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");this.each(function(b,c){for(var g=" "+c.className+" ";d.test(g);)g=g.replace(d," ");c.className=a.trim(g)});return!c?this:this.addClass(c)}})(jQuery);
(function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,f){a(window).scrollTo(b,c,f)};c.defaults={axis:"xy",duration:1.3<=parseFloat(a.fn.jquery)?0:1,limit:!0};c.window=function(){return a(window)._scrollable()};a.fn._scrollable=function(){return this.map(function(){if(this.nodeName&&-1==a.inArray(this.nodeName.toLowerCase(),["iframe","#document","html","body"]))return this;var b=(this.contentWindow||this).document||this.ownerDocument||this;return a.browser.safari||
"BackCompat"==b.compatMode?b.body:b.documentElement})};a.fn.scrollTo=function(d,e,f){"object"==typeof e&&(f=e,e=0);"function"==typeof f&&(f={onAfter:f});"max"==d&&(d=9E9);f=a.extend({},c.defaults,f);e=e||f.duration;f.queue=f.queue&&1<f.axis.length;f.queue&&(e/=2);f.offset=b(f.offset);f.over=b(f.over);return this._scrollable().each(function(){function g(a){l.animate(k,e,f.easing,a&&function(){a.call(this,d,f)})}var j=this,l=a(j),h=d,m,k={},p=l.is("html,body");switch(typeof h){case "number":case "string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(h)){h=
b(h);break}h=a(h,this);case "object":if(h.is||h.style)m=(h=a(h)).offset()}a.each(f.axis.split(""),function(a,b){var d=b=="x"?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,s=j[n],r=c.max(j,b);if(m){k[n]=m[e]+(p?0:s-l.offset()[e]);if(f.margin){k[n]=k[n]-(parseInt(h.css("margin"+d))||0);k[n]=k[n]-(parseInt(h.css("border"+d+"Width"))||0)}k[n]=k[n]+(f.offset[e]||0);f.over[e]&&(k[n]=k[n]+h[b=="x"?"width":"height"]()*f.over[e])}else{d=h[e];k[n]=d.slice&&d.slice(-1)=="%"?parseFloat(d)/100*r:d}f.limit&&/^\d+$/.test(k[n])&&
(k[n]=k[n]<=0?0:Math.min(k[n],r));if(!a&&f.queue){s!=k[n]&&g(f.onAfterFirst);delete k[n]}});g(f.onAfter)}).end()};c.max=function(b,c){var f="x"==c?"Width":"Height",g="scroll"+f;if(!a(b).is("html,body"))return b[g]-a(b)[f.toLowerCase()]();var f="client"+f,j=b.ownerDocument.documentElement,l=b.ownerDocument.body;return Math.max(j[g],l[g])-Math.min(j[f],l[f])}})(jQuery);
function normalizeSFID(a){if(null==a)return a;a=a.replace(/\"/g,"");if(15!=a.length)return a;for(var b="",c=0;3>c;c++){for(var d=0,e=0;5>e;e++){var f=a.charAt(5*c+e);"A"<=f&&"Z">=f&&(d+=1<<e)}b=25>=d?b+"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(d):b+"012345".charAt(d-26)}return a+b}Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};
Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};function populateTask(a,b){!0==skipPoll&&(skipPollOutsideOfFn=!0);skipPoll=!0;TASKRAY.trController.fetchTasksFromList(currentBoardId,a,getViewAsUserId(),function(a,d){if(!0==d.status&&(!0!=skipPollOutsideOfFn&&!0!=dragging||!0==b))$j.each(a,function(a,b){updatedPersistedSortableTask(b);var c=$j.extend(!0,{},b);c.task.buttonType=c.task.TASKRAY__List__c!=lastListColName?"Next":"None";c.task.Name=wbr(c.task.Name,9);$j("#"+b.task.Id).replaceWith($j(taskCardTemplate(c)))}),getSideBarUsersPhotos(),$j(".task-deadline:contains('ago')").css("color",
"red"),$j(".task-deadline:contains('yesterday')").css("color","red");updateColumnCounts();skipPollOutsideOfFn=skipPoll=!1})}var persistedsortable=[];
function populateTasks(a,b,c){skipPoll=!0;TASKRAY.trController.fetchTasks_v2(a,b,getViewAsUserId(),function(a,b){if(!0==b.status){$j(".task").remove();var f=[];$j.each(a,function(a,b){f.push([b,b.sortOrder])});f.sort(function(a,b){return a[1]===b[1]?b[0].task.CreatedDate-a[0].task.CreatedDate:a[1]-b[1]});persistedsortable=f;$j.each(f,function(a,b){var c=$j.extend(!0,{},b[0]);c.task.buttonType=c.task.TASKRAY__List__c!=lastListColName?"Next":"None";c.task.Name=wbr(c.task.Name,9);$j(taskCardTemplate(c)).appendTo("#column-"+
findListNameMapMatch(c.task.TASKRAY__List__c))});$j(".task").css("display","block");$j(".task-deadline:contains('ago')").css("color","red");$j(".task-deadline:contains('yesterday')").css("color","red");c();getSideBarUsersPhotos()}else $j(".task-list").css("display","block");updateColumnCounts();skipPollOutsideOfFn=skipPoll=!1})}
function quickRefreshAllTasks(a){var b=[];$j.each(a,function(a,d){b.push([d,d.sortOrder])});b.sort(function(a,b){return a[1]===b[1]?b[0].task.CreatedDate-a[0].task.CreatedDate:a[1]-b[1]});findTaskNotificationsForTaskBoard(persistedsortable,b);persistedsortable=b;a=$j.map($j(".selected-task"),function(a){return $j(a).attr("id")});$j(".task").remove();$j.each(b,function(a,b){var e=$j.extend(!0,{},b[0]);e.task.buttonType=e.task.TASKRAY__List__c!=lastListColName?"Next":"None";e.task.Name=wbr(e.task.Name,
9);$j(taskCardTemplate(e)).appendTo("#column-"+findListNameMapMatch(e.task.TASKRAY__List__c))});$j(".task").css("display","block");$j(".task-deadline:contains('ago')").css("color","red");$j(".task-deadline:contains('yesterday')").css("color","red");$j("#"+a.join(",#")).addClass("selected-task");updateColumnCounts();getSideBarUsersPhotos()}
function updateColumnCounts(){var a={};$j.each(listNameArr,function(b){a[b]=$j("#column-"+b).find(".task:visible").length});$j.each(a,function(a,c){0<c?$j("#taskboard-header-count-"+a).html(c).show():$j("#taskboard-header-count-"+a).hide()})}
function refreshTasksInColumn(a){boardInfo=getBoardInfo();TASKRAY.trController.fetchTasks_v2(boardInfo.boardParam,boardInfo.wherestr,getViewAsUserId(),function(b,c){if(!0==c.status){var d=[];$j.each(b,function(a,b){d.push([b,b.sortOrder])});d.sort(function(a,b){return a[1]===b[1]?b[0].task.CreatedDate-a[0].task.CreatedDate:a[1]-b[1]});$j("#"+a.toLowerCase()+" .task").remove();$j.each(d,function(a,b){var c=$j.extend({},b[0]);c.task.buttonType=c.task.TASKRAY__List__c!=lastListColName?"Next":"None";
c.task.Name=wbr(c.task.Name,9);$j(taskCardTemplate(c)).appendTo("#column-"+findListNameMapMatch(c.task.TASKRAY__List__c))});$j(".task").css("display","block");$j(".task-deadline:contains('ago')").css("color","red");$j(".task-deadline:contains('yesterday')").css("color","red");getSideBarUsersPhotos()}})};var emptyInviteModal;
function populateChatterGroupSelect(a){TASKRAY.trController.getChatterGroups(!1,function(b){$j.cookie("apex__bltr-selected-group");$j("#chatter-group-dropdown").html("");var c="";b.length==0?c='<option value="" disabled selected>No projects shared yet.</option>':$j.each(b,function(a,b){var f="";$j.cookie("apex__bltr-selected-group")==b.chatterGroupId&&(f='selected="selected"');c=c+"<option "+f+' value="'+b.chatterGroupId+'" image="'+b.chatterGroupPhotoUrl+'">'+b.chatterGroupName+"</option>"});$j("#chatter-group-dropdown").html(c);
typeof a=="function"&&a()})}
function attachSidebarFunctions(){var a=$j(".project-select");$j(".project-actions").css("visibility","hidden");bindClickFunction($j(".display-unassigned-tasks"),function(){displayUnassignedTasks=$j(".display-unassigned-tasks").is(":checked")?!0:!1;refreshTasks();toggleDisplayUnassignedTasks()});bindClickFunction($j("#new-project-btn"),function(){$j("#project-frame").contents().find("#project-edit-content").empty();var a=0<$j("#chatter-group-dropdown").length?"&chattergroup="+$j("#chatter-group-dropdown option:selected").val():
"";$j("#project-frame").contents().find("#project-edit-content").empty();$j("#project-frame").attr("src",trProjectPage+"?controller=project&editmode=true&type=new"+a);$j("#project-modal").modal("show");chatterGroupIds=""});bindClickFunction($j(".project-action-icon-edit"),function(){showProjectModal($j(this).parent().parent().attr("id"))});bindClickFunction($j(".project-action-icon-editContribs"),function(){$j("#project-frame").contents().find("#project-edit-content").empty();$j("#project-frame").attr("src",
"about:blank");$j("#project-frame").attr("src",trProjectPage+"?id="+$j(this).parent().parent().attr("id")+"&controller=project&tab=contributors");$j("#project-modal").modal("show");chatterGroupIds=""});bindClickFunction($j(".project-select"),function(a){!$j(a.target).hasClass("project-action-icon")&&!$j(a.target).hasClass("project-follow-toggle")&&!$j(a.target).hasClass("project-follow")&&!$j(a.target).hasClass("project-unfollow-img")&&(showLoadMask(function(){}),changeProjectViewStatus($j(this).attr("id")))});
bindClickFunction($j(".bulk-project-select-container a"),function(a){$j(a.target).hasClass("bulk-project-select")?toggleAllProjectStatuses("select"):$j(a.target).hasClass("bulk-project-deselect")&&toggleAllProjectStatuses("deselect")});bindClickFunction($j(".group-sidebar-element"),function(){$j.cookie("apex__bltr-selected-group",$j(this).attr("id"));$j(".group-sidebar-element").removeClass("selected-group");$j(this).addClass("selected-group");initPage()});$j("#chatter-group-dropdown").unbind("change");
$j("#chatter-group-dropdown").change(function(){$j.cookie("apex__bltr-selected-group",$j(this).val());updateHeaderImageWithChatterGroup();initPage()});var b=JSON.parse($j.cookie("bltr_sidebarcollapsed"));$j.each(a,function(a,d){var e="#"+$j(d).attr("id"),f=e+"-color",g=$j(e).children(".project-list-square");$j(e).hasClass("project-sidebar-inactive")?$j(g).find(".project-lock-icon-div").removeClass("project-lock-icon-div-white").addClass("project-lock-icon-div-black"):($j(g).css("border-color",$j(f).val()),
$j(g).css("background-color",$j(f).val()));e=$j(e).children(".project-collapse-container");"true"==e.attr("hasChildren")&&(f=null!=b&&-1!==$j.inArray($j(d).attr("id"),b)?"plus":"minus",e.html('<a class="halflings '+f+' sidebar-collapse-project" href=""><i></i></a>'))});bindClickFunction($j(".project-collapse-container"),function(a){a.preventDefault();a.stopPropagation();toggleSidebarProjectCollapse($j(this).parent().attr("id"))});$j(".project-select").unbind("mouseenter mouseleave").hover(function(){if(!dragging){$j(this).find("a").css("background-color",
muteColor($j("#"+$j(this).attr("id")+"-color").val()));$j(this).find(".project-actions").css("visibility","visible");var a=$j(this).find(".project-actions").height();$j(this).find(".project-actions").height(a-1).height(a)}},function(){dragging||($j(this).find("a").css("background","none"),"projectSearchResults"!=$j(this).parent().attr("id")&&$j(this).find(".project-actions").css("visibility","hidden"),$j(this).hasClass("project-sidebar-inactive")||$j(this).find(".project-list-square").css("background",
$j("#"+$j(this).attr("id")+"-color").val()).css("border-color",$j("#"+$j(this).attr("id")+"-color").val()))});bindClickFunction($j("#search-projects"),function(){$j("#projectSearchTermInput").val("");$j("#projectSearchResults").empty();$j("#search-projects-modal").modal("show");$j("#projectSearchTermInput").focus()});bindClickFunction($j("#searchArchivedInput"),function(){3<=$j("#projectSearchTermInput").val().length&&searchProjects()});$j("#projectSearchTermInput").keypress(function(a){"13"==a.keyCode?
a.preventDefault():(timeoutHnd&&clearTimeout(timeoutHnd),timeoutHnd=setTimeout("searchProjects();",500))});bindClickFunction($j(".project-follow-toggle"),function(){var a=$j(this).parents(".project-select").attr("id");if(null==a)var a=$j(this).parents(".search-project-select").attr("id"),b=!0;skipPoll=!0;TASKRAY.trController.toggleFollowTask(a,function(e,f){f.status&&(!0==b?(populateProjects(function(){setBoardView(function(a){"columns-view"==a&&refreshTasks();(a="deadline-view")&&setColumnView(function(){populateDeadlineView()})})}),
populateSearchProject(a)):populateProject(a));skipPoll=!1},{escape:!0})});attachSearchFixFunctions();bindClickFunction($j(".project-action-icon-go"),function(){$j.cookie("apex__bltrProjectId",$j(this).parent().parent().attr("id"),{expires:365,path:"/",secure:!0});window.location=trProjectBoardPage});bindClickFunction($j("#modify-contributors"),function(){var a="";$j(".project-select").each(function(b,e){$j(e).hasClass("project-sidebar-inactive")||(a=$j(e).attr("id"))});$j("#project-frame").attr("src",
"about:blank");$j("#project-modal").modal("show");setTimeout(function(){$j("#project-frame").attr("src",trProjectPage+"?controller=project&id="+a+"&tab=contributors")},200)});bindClickFunction($j("#toggle-sidebar"),function(){$j("#sidebar").is(":visible")?(toggleSidebar("hide"),$j("#toggle-sidebar").removeClass("chevron-right").addClass("chevron-left")):(toggleSidebar("show"),$j("#toggle-sidebar").removeClass("chevron-left").addClass("chevron-right"))});bindClickFunction($j("#toggle-header"),function(){$j("#AppBodyHeader").is(":visible")?
($j("#AppBodyHeader").hide(),$j("#toggle-header").removeClass("resize_full").addClass("resize_small")):($j("#AppBodyHeader").show(),$j("#toggle-header").removeClass("resize_small").addClass("resize_full"));refreshColumnHeights()});bindClickFunction($j(".project-action-icon-editContribs-tooltip"),function(){$j(this).tooltip("hide")});applyPersistedSidebarCollapse();$j(".sidebar-view-toggle").on("shown",function(){sideBarWiggleFixForChrome()});bindClickFunction($j("#sidebar-chatter-refresh"),function(){fetchChatterForSidebar()});
$j(".sidebar-bin-icon").draggable({appendTo:"body",helper:"clone",start:function(){dragging=!0},stop:function(){dragging=!1}});attachTaskCardDroppable()}function sideBarWiggleFixForChrome(){var a=$j("#sidebar").height();$j("#sidebar").height(a-1);$j("#sidebar").height()}
function fetchChatterForSidebar(){$j("#sidebar-chatter-activity-container").html(labels.TaskRay_Sidebar_ChatterLoadingLabel);var a=[],a=a.concat($j.map($j(".project-select:not(.project-sidebar-inactive)"),function(a){return $j(a).attr("id")})),a=a.concat(getCurrentlyDisplayedTaskIds());TASKRAY.trController.getChatterForRecordIds(a,100,function(a){a=JSON.parse(a);a=sortAndParseChatterFeed(a,a.users);a=a.slice(0,100);refreshChatterInSidebar(a);setTimeout(sideBarWiggleFixForChrome,1E3)},{escape:!1})}
function getCurrentlyDisplayedTaskIds(){if("deadline"==$j.cookie("bltr_view"))return $j.map($j(".deadline-view-task"),function(a){return $j(a).attr("id")});if("planning"==$j.cookie("bltr_view")){var a=[],a=a.concat($j.map($j(".planning-view-unassigned-task-drag"),function(a){return $j(a).attr("itemid")}));return a=a.concat($j.map($j(".planning-view-task"),function(a){return $j(a).attr("lineid")}))}return $j.map($j(".task"),function(a){return $j(a).attr("id")})}
function sortAndParseChatterFeed(a,b){var c={};$j.each(b,function(a,b){c[b.Id]=b});var d=[],d=d.concat(a.projectfeed),d=d.concat(a.taskfeed);$j.each(d,function(a,b){var d=Date.parse(b.CreatedDate);b.smallPhotoUrl=c[b.InsertedById].SmallPhotoUrl;b.smallPhotoText=c[b.InsertedById].Name;b.FeedComments&&$j.each(b.FeedComments.records,function(a,b){Date.parse(b.CreatedDate)>d&&(d=Date.parse(b.CreatedDate));b.smallPhotoUrl=c[b.InsertedById].SmallPhotoUrl;b.smallPhotoText=c[b.InsertedById].Name});b.sortTimeStamp=
d});d.sort(function(a,b){return b.sortTimeStamp-a.sortTimeStamp});return d}
function refreshChatterInSidebar(a){var b="";$j.each(a,function(a,d){b+=generateChatterPostDiv(d)});$j("#sidebar-chatter-activity-container").html(b);$j(".sidebar-chatter-timeago.timeago").timeago();$j(".sidebar-chatter-comments-container").each(function(){var a=$j(this).children(".sidebar-chatter-comment");if(3<a.length){var b=a.length;a.each(function(a){a<b-3&&$j(this).addClass("sidebar-chatter-hidden-comment")});$j(this).before("<a class='sidebar-chatter-show-hidden pointer pull-left' style='color:#7d7d84;'>"+labels.TaskRay_Sidebar_ChatterCommentShowAllPrefix+
" "+b+" "+labels.TaskRay_Sidebar_ChatterCommentShowAllSuffix+"</a><div class='clear'></div>")}});bindClickFunction($j(".sidebar-chatter-show-hidden"),function(){$j(this).siblings(".sidebar-chatter-comments-container").children().removeClass("sidebar-chatter-hidden-comment");$j(this).remove()})}function generateChatterPostDiv(a){return sidebarChatterPostTemplate(a)}function refreshSidebarUserPhotos(){$j("#group-members-photos").html("");getSideBarUsersPhotos()}
function getSideBarUsersPhotos(){var a=[];("project"==currentBoardId||"my"==currentBoardId)&&$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push(this.id)});"group"==currentBoardId&&a.push($j("#chatter-group-dropdown option:selected").val());skipPoll=!0;TASKRAY.trController.sidebarMembersListv2(currentBoardId,a,null,function(a,b){if(!0==b.status){var e=0;(function(a){$j("#group-members-photos").html("");"group"==currentBoardId&&$j("#group-members-photos").html('<span id="group-members-photos-label">'+
labels.TaskRay_Sidebar_ContributorsGroupMemberLabel+'</span><div style="clear:both"></div>');$j.each(b.result,function(a,b){var c='<img id="'+b.Id+'" class="projmem-drag memthumbnail" width="32" height="32"title="'+b.FirstName+" "+b.LastName+'" alt="'+b.FirstName+" "+b.LastName+'" src="'+b.SmallPhotoUrl+'" />';$j("#group-members-photos").append(c);e+=1});18<e&&("group"==currentBoardId?$j("#group-members-photos").prepend('<div id="showallmemsdiv"></div>'):$j("#group-members-photos").prepend('<div id="showallmemsdiv"></div><div style="clear:both"></div>'));
$j("#showallmemsdiv").html('<a href="javascript:void(0);" id="showallmems">'+labels.TaskRay_Sidebar_ContributorsShowMoreLink+" ("+e+")</a>");bindClickFunction($j("#showallmems"),function(){"visible"==$j("#group-members-photos").css("overflow")?($j("#group-members-photos").css({"max-height":"118px",overflow:"hidden"}),$j("#showallmems").text($j("#showallmems").text().replace(labels.TaskRay_Sidebar_ContributorsShowLessLink,labels.TaskRay_Sidebar_ContributorsShowMoreLink))):($j("#group-members-photos").css({"max-height":"none",
overflow:"visible"}),$j("#showallmems").text($j("#showallmems").text().replace(labels.TaskRay_Sidebar_ContributorsShowMoreLink,labels.TaskRay_Sidebar_ContributorsShowLessLink)))});a()})(function(){$j(".projmem-drag").draggable({appendTo:"body",helper:"clone",start:function(){dragging=!0},stop:function(){dragging=!1}});attachTaskCardDroppable()})}skipPoll=!1});if("group"==currentBoardId){a=[];$j(".project-select:not(.project-sidebar-inactive)").each(function(){a.push(this.id)});var b=[];"group"==currentBoardId&&
b.push($j("#chatter-group-dropdown option:selected").val());TASKRAY.trController.sidebarMembersListv2("additionalMembers",a,b,function(a,b){!0==b.status&&function(a){$j("#additional-members").html("");$j.each(b.result,function(a,b){var c='<img id="'+b.Id+'" class="projmem-drag memthumbnail" width="32" height="32"title="'+b.FirstName+" "+b.LastName+'" alt="'+b.FirstName+" "+b.LastName+'" src="'+b.SmallPhotoUrl+'" />';$j("#additional-members").append(c)});a()}(function(){$j(".projmem-drag").draggable({appendTo:"body",
helper:"clone",start:function(){dragging=!0},stop:function(){dragging=!1}});attachTaskCardDroppable()});skipPoll=!1})}}
function attachTaskCardDroppable(){$j(".task").not(".sort-disabled").droppable({accept:function(a){if(a.hasClass("projmem-drag")||a.hasClass("project-select")||a.hasClass("sidebar-bin-icon"))return $j(this).position().left+$j(this).width()/2<$j("#sidebar").position().left?!0:!1},over:function(a,b){b.draggable.hasClass("project-select")?($j(this).children(".taskcard-wrapper").css("border-left-color",$j("#"+b.draggable.attr("id")+"-color").val()),$j(".task.selected-task .taskcard-wrapper").css("border-left-color",
$j("#"+b.draggable.attr("id")+"-color").val())):b.draggable.hasClass("sidebar-bin-icon")?($j(this).add(".task.selected-task").addClass("delete-hover-styling"),$j(this).add(".task.selected-task").find(".taskcard-action-icon .glyphicons").addClass("bin")):$j(this).hasClass("sort-disabled")?$j(this).find(".task-card-photo").attr("src",rednoicon):($j(this).find(".task-card-photo").css("box-shadow","2px 2px 2px #666"),$j(".task.selected-task").find(".task-card-photo").css("box-shadow","2px 2px 2px #666"))},
out:function(a,b){if(b.draggable.hasClass("project-select")){var c=$j(this).children(".taskcard-wrapper"),d=void 0===$j("#"+$j(this).attr("projectid")+"-color").val()?"#cccccc":$j("#"+$j(this).attr("projectid")+"-color").val();c.css("border-left-color",d);$j(".task.selected-task").each(function(){var a=void 0===$j("#"+$j(this).attr("projectid")+"-color").val()?"#cccccc":$j("#"+$j(this).attr("projectid")+"-color").val();$j(this).children(".taskcard-wrapper").css("border-left-color",a)})}else b.draggable.hasClass("sidebar-bin-icon")?
($j(this).add(".task.selected-task").removeClass("delete-hover-styling"),$j(this).add(".task.selected-task").find(".taskcard-action-icon .glyphicons").removeClass("bin")):($j(this).find(".task-card-photo").css("box-shadow","none"),$j(".task.selected-task").find(".task-card-photo").css("box-shadow","none"))},drop:function(a,b){var c=$j.map($j(".task.selected-task"),function(a){return a.id}),d=$j(this);d.hasClass("selected-task")||c.push(d.attr("id"));b.draggable.hasClass("projmem-drag")?(updateTaskOwners(b,
c),$j(this).find(".task-card-photo").css("box-shadow","none"),$j(".task.selected-task").find(".task-card-photo").css("box-shadow","none")):b.draggable.hasClass("sidebar-bin-icon")?($j(this).add(".task.selected-task").removeClass("delete-hover-styling"),deleteTasks(c),$j(this).add(".task.selected-task").find(".taskcard-action-icon .glyphicons").removeClass("bin")):($j("#"+c.join(",#")).children(".task-card").css("border-left-color",$j("#"+b.draggable.attr("id")+"-color").val()),$j("#"+b.draggable.attr("id")).children("a").css("background",
"none"),populateProjects(function(){return 0}),updateTasksProject(b,c))},activate:function(){},deactivate:function(a,b){$j("#"+b.draggable.attr("id")).children("a").css("background","none")}})}
function deleteTasks(a){skipPoll=!0;updateTaskAnimate_bulk(a,"100",!0);TASKRAY.trController.deleteTasks(a,function(b,c){if(!1==c.status)$j("#memberAssignment-warning .modal-body").html(labels.TaskRay_Delete_Failure_Message+"<br /><br />"+c.message),$j("#memberAssignment-warning").modal("show");else{var d=[];$j.each(a,function(a,b){d.push({taskId:b})});b={name:"deleteTasks",data:d};addUndoEvent(b)}skipPoll=!1})}
function updateTasksProject(a,b){skipPoll=!0;var c=$j("#"+a.draggable.attr("id")).hasClass("project-sidebar-inactive");updateTaskAnimate_bulk(b,"100",c);getSideBarUsersPhotos();TASKRAY.trController.assignProjectSidebarDrop_bulk(b,a.draggable.attr("id"),function(a,c){c.status&&(a={name:"taskProjectChanged",data:[]},$j.each(b,function(b,c){var e=findTaskInSortable(persistedsortable,c);a.data.push({taskId:c,oldProjectId:e.task.TASKRAY__Project__c})}),addUndoEvent(a));skipPoll=!1},{escape:!0})}
function updateTaskOwners(a,b){var c={};$j.each(b,function(a,b){var d=$j("#"+b).find(".task-card-photo"),j={};0==d.length?(j.hasImage=!1,$j("#"+b).children().find(".task-header-content").prepend('<div class="pull-right"><img class="task-card-photo" src="#" /></div>')):(j.hasImage=!0,j.src=d.attr("src"),j.title=d.attr("title"),j.alt=d.attr("alt"));c[b]=j});var d=$j("#"+b.join(",#"));$j(d).find(".task-card-photo").attr("src",$j(a.draggable).attr("src"));$j(d).find("img").eq(0).attr("title",$j(a.draggable).attr("title"));
$j(d).find("img").eq(0).attr("alt",$j(a.draggable).attr("alt"));skipPoll=!0;TASKRAY.trController.assignOwnerSidebarDrop_bulk(b,$j(a.draggable).attr("id"),function(e,f){!1==f.status?($j("#memberAssignment-warning .modal-body").html("Whoops! "+$j(a.draggable).attr("alt")+" cannot be assigned this task:<br /><br />"+f.message),$j("#memberAssignment-warning").modal("show"),$j.each(b,function(a,b){rollBackInfo=c[b];if(!1==rollBackInfo.hasImage)$j("#"+b).find(".task-card-photo").remove();else{var d=$j("#"+
b).find(".task-card-photo");d.attr("src",rollBackInfo.src);d.attr("title",rollBackInfo.title);d.attr("alt",rollBackInfo.alt)}})):("my"==currentBoardId&&$j(a.draggable).attr("id")!=currentUserId&&($j(d).remove(),$j(".ui-effects-wrapper").remove()),TASKRAY.trController.taskOwnershipChanged_bulk(b,$j(a.draggable).attr("id"),function(){}));e={name:"taskOwnerChanged",data:[]};$j.each(b,function(a,b){var c=findTaskInSortable(persistedsortable,b);e.data.push({taskId:b,oldOwnerId:c.task.OwnerId})});addUndoEvent(e);
skipPoll=!1},{escape:!0});updateTaskAnimate_bulk(b,"100",!1)}
function populateSideBarProjectFileLinks(a){skipPoll=!0;null==a&&(a=$j(".project-select:not(.project-sidebar-inactive)").attr("id"));null!=a&&""!=a&&"undefined"!==typeof a&&TASKRAY.trController.projectFiles_v3(a,function(a,c){!0==c.status&&($j("#project-files-list").html('<li class="nav-header">Project Files</li>'),$j.each(a,function(a,b){iconClass="file";"LinkPost"==b.PostType?(iconClass="link",$j("#project-files-list").append('<li class="project-file-link" href="'+b.LinkURL+'"><span class="project-files-icon halflings '+
iconClass+'"><i></i></span><span class="project-file-name">'+b.LinkTitle+'</span></div><div class="clear"></li>')):("undefined"!==typeof b.ContentType&&-1!=b.ContentType.indexOf("image")&&(iconClass="picture"),$j("#project-files-list").append('<li class="project-file-filelink" id="'+b.RelatedRecordId+'"><span class="project-files-icon halflings '+iconClass+'"><i></i></span><span class="project-file-name">'+b.ContentFileName+'</span></div><div class="clear"></li>'))}),attachsidebarProjectLinksClickFunctions());
skipPoll=!1})}
function changeProjectViewStatus(a){var b="#"+a;element=$j(b.toString());var c="#"+a+".project-list-square",d="#"+a+"-color";if("project"==currentBoardId){$j.cookie("apex__bltrProjectId",$j(b).attr("id"),{expires:365,path:"/",secure:!0});$j(".task").remove();var e=$j(".project-select:not(.project-sidebar-inactive)");$j(e).addClass("project-sidebar-inactive");$j(e).find(".project-list-square").css("background-color","#FFFFFF").css("background-color","#FFFFFF").css("border-color","#DCDCDC");$j(b.toString()).removeClass("project-sidebar-inactive");
$j(c).css("background-color",$j(d).val());$j(c).css("border-color",$j(d).val());"project"==currentBoardId&&populateSideBarProjectFileLinks(a);initPageAfterSidebar()}else element.hasClass("project-sidebar-inactive")?(skipPoll=!0,TASKRAY.trController.setViewProjectTasks_v2(a,!0,getViewAsUserId(),function(a,e){if(e.status){$j(b).removeClass("project-sidebar-inactive");$j(c).css("background-color",$j(d).val());$j(c).css("border-color",$j(d).val());$j(b).find(".project-name-link").css("color","black");
initPageAfterSidebar()}skipPoll=false},{escape:!0})):(skipPoll=!0,TASKRAY.trController.setViewProjectTasks_v2(a,!1,getViewAsUserId(),function(a,d){if(d.status){$j(b).addClass("project-sidebar-inactive");$j(c).css("background-color","#FFFFFF");$j(c).css("border-color","#DCDCDC");$j(b).find(".project-name-link").css("color","grey");initPageAfterSidebar()}skipPoll=false},{escape:!0}))}
function toggleAllProjectStatuses(a){var b=[];$j(".project-select").each(function(){b.push($j(this).attr("id"))});skipPoll=!0;TASKRAY.trController.setViewProjectTasks_bulk(b,"deselect"==a?!1:!0,getViewAsUserId(),function(){"select"==a?($j(".project-select").removeClass(".project-sidebar-inactive"),$j(".project-select").each(function(){var a=$j(this).children(".project-color-input").val();$j(this).children(".project-list-square").css("background-color",a).css("border-color",a)})):"deselect"==a&&$j(".project-select .project-list-square").addClass(".project-sidebar-inactive").css("background-color",
"#FFFFFF").css("border-color","#DCDCDC");initPageAfterSidebar();skipPoll=!1})}function sortProjectObject(a){return a=a.sort(function(a,c){var d=a.project.Name.toLowerCase(),e=c.project.Name.toLowerCase();return d<e?-1:d>e?1:0})}persistedProjectObject=null;
function populateProjects(a){skipPoll=!0;null!=$j.cookie("apex__bltrProjectId")&&null==$j.cookie("apex__bltrProjectId").match(/[a-zA-Z0-9]{15,18}/g)&&$j.cookie("apex__bltrProjectId",null,{expires:365,path:"/",secure:!0});TASKRAY.trController.projectFilterList_v3(parseSFIDCookieValue($j.cookie("apex__bltrProjectId")),currentBoardId,getGroupId(),getViewAsUserId(),function(b,c){c.status&&(0==b.length&&"group"==currentBoardId?($j("#projects-sidebar .project-select").remove(),$j(".group-share-message").remove(),
$j("#projects-sidebar").append('<li class="group-share-message" style="color:#888;">No projects have been shared with this group yet.</li>'),"function"===typeof a&&a()):(function(c){persistedProjectObject=b=sortSidebar_projects(b);$j("#projects-sidebar .project-select").remove();$j(".group-share-message").remove();$j.each(b,function(a,b){var c=$j("#projectTemplate-sidebar").tmpl(b);$j("#projects-sidebar").append(c)});"project"==currentBoardId&&(populateSideBarProjectFileLinks(parseSFIDCookieValue($j.cookie("apex__bltrProjectId"))),
$j("#projects-sidebar .project-action-icon-go").remove());attachSidebarFunctions();c(a)}(function(a){$j(".project-select").draggable({connectToSortable:".task",appendTo:"body",helper:function(){var a=$j(this).clone();a.children(".project-actions").hide();a.css("background-color",muteColor($j("#"+a.attr("id")+"-color").val())).css("list-style","none").css("min-width","100px").css("padding-top","3px");return a},start:function(){dragging=!0},stop:function(){dragging=!1}});attachTaskCardDroppable();"function"===
typeof a&&a()}),skipPoll=!1))})}var projectChangeTimeStampStart=0,projectChangeTimeStampEnd=0,last_projectChangeTimeStampStart=0,last_projectChangeTimeStampEnd=0;
function checkForProjectSideboardChanges(){!0!=skipPoll&&!0!=dragging?(last_projectChangeTimeStampStart=projectChangeTimeStampStart,last_projectChangeTimeStampEnd=projectChangeTimeStampEnd,projectChangeTimeStampStart=(new Date).getTime(),projectChangeTimeStampEnd=projectChangeTimeStampStart+global_pollingInterval,TASKRAY.trController.projectFilterList_v3(parseSFIDCookieValue($j.cookie("apex__bltrProjectId")),currentBoardId,getGroupId(),getViewAsUserId(),function(a,b){!0==b.status&&(sortedResults=
sortSidebar_projects(a),Object.equals(sortedResults,persistedProjectObject)||(findProjectNotificationsForTaskBoard(persistedProjectObject,sortedResults),populateProjects()),setTimeout(checkForProjectSideboardChanges,global_pollingInterval))})):setTimeout(checkForProjectSideboardChanges,global_pollingInterval)}
function findProjectNotificationsForTaskBoard(a,b){oldInfo={};$j.each(a,function(a,b){oldInfo[b.project.Id]=b.project.LastModifiedDate});newInfo={};$j.each(b,function(a,b){newInfo[b.project.Id]=b.project.LastModifiedDate});diff=$j.objectDiff(oldInfo,newInfo);whereObj={};$j.each(diff,function(a,b){whereObj[a]=b[1]});whereArr=[];$j.each(whereObj,function(a){whereArr.push(a)});type="project";TASKRAY.trController.fetchNotifications(type,whereArr,last_projectChangeTimeStampStart,last_projectChangeTimeStampEnd,
function(a,b){!0==b.status&&(notificationStr="",$j.each(a,function(a,b){var c=b.TASKRAY__EventDescr__c;notificationStr=notificationStr+$j("<div/>").html(c).text()+"<br />"}),""!=notificationStr&&$j.noty({text:notificationStr,theme:"noty_theme_twitter",layout:"topCenter",type:"alert",animateOpen:{height:"toggle"},animateClose:{height:"toggle"},speed:500,timeout:4E3,closeButton:!0,closeOnSelfClick:!0,closeOnSelfOver:!1,modal:!1}))})}
function toggleProjects(){$j(".toggleprojects").attr("checked")?$j(".project-select").each(function(a,b){$j(b).hasClass("project-sidebar-inactive")||changeProjectViewStatus(b.id)}):$j(".project-select").each(function(a,b){$j(b).hasClass("project-sidebar-inactive")&&changeProjectViewStatus(b.id)})}
function attachUserSeachTypeahead(){$j("#invite-search-input").keypress(function(a){"13"==a.keyCode?a.preventDefault():(timeoutHnd&&clearTimeout(timeoutHnd),timeoutHnd=setTimeout("searchUsers();",500))})}
function searchUsers(){if(2<$j("#invite-search-input").val().length){var a="";$j(".project-select").each(function(b,c){$j(c).hasClass("project-sidebar-inactive")||(a=$j(c).attr("id"))});TASKRAY.trController.getUserNamesAndAccess($j("#invite-search-input").val(),a,function(a,c){$j(".result-row").remove();!0==c.status&&$j.each(c.result,function(a,b){var c="",g="",j="",c="true"==$j("#project-records-sharing-level").val()||!0==b.isOwner?'<input id="'+b.user.Id+'-readonly" class="read-checkbox" type="checkbox" previous="true" checked="checked" disabled="disabled"  />':
b.readAccess?'<input id="'+b.user.Id+'-readonly" class="read-checkbox" previous="true" type="checkbox" checked="checked" +  />':'<input id="'+b.user.Id+'-readonly" class="read-checkbox" previous="false" type="checkbox" />',g=!0==b.isOwner?'<input id="'+b.user.Id+'-readwrite" type="checkbox" previous="true" checked="checked" disabled="disabled" />':b.readWriteAccess?'<input id="'+b.user.Id+'-readwrite" class="write-checkbox" previous="true" type="checkbox" checked="checked" />':'<input id="'+b.user.Id+
'-readwrite" class="write-checkbox" previous="false" type="checkbox" />';!0==b.isOwner&&(j='&nbsp;<span class="label label-info">Project Owner</span>');$j("#invite-search-results-table tbody").append('<tr class="result-row" id="'+b.user.Id+'"><td id="'+b.user.Id+'-name" style="min-width:275px;">'+b.user.Name+j+'</td><td style="text-align:center;"text-align:center;">'+c+'</td><td style="text-align:center;">'+g+"</td></tr>");$j(".write-checkbox").change(function(){var a=$j("#"+$j(this).parents("tr").attr("id")+
"-readonly");$j(this).is(":checked")?a.prop("disabled",!0):a.prop("disabled",!1);a.is(":checked")||a.prop("checked",!0)});$j(".read-checkbox").change(function(){var a=$j("#"+$j(this).parents("tr").attr("id")+"-readwrite");$j(this).is(":checked")?a.prop("disabled",!1):a.prop("disabled",!0);a.is(":checked")&&a.prop("checked",!1)})})},{escape:!0})}}function parseSFIDCookieValue(a){return"null"==a?null:a}
function updateHeaderImageWithChatterGroup(){$j("#chatter-group-dropdown").find(":selected").attr("image")&&$j(".pageTitleIcon").attr("src",$j("#chatter-group-dropdown").find(":selected").attr("image"))}function toggleSidebar(a){"hide"==a?($j("#sidebar").hide(),$j("#inner-container").css("margin-right","0px"),$j("#inner-container").css("width",$j(window).width()-20+"px")):"show"==a&&($j("#sidebar").show(),$j("#inner-container").css("margin-right","300px"),columnViewPortWidthRecalc())}
function sortSidebar_projects(a){var b=[],c={};$j.each(a,function(a,d){b.push(d.project.Id);c[d.project.Id]=d});a.sort(function(a,b){return a.project.Name.toLowerCase()<b.project.Name.toLowerCase()?-1:a.project.Name.toLowerCase()>b.project.Name.toLowerCase()?1:0});var d=[],e=[];$j.each(a,function(a,c){var f=c.project.TASKRAY__Project_Parent__c;if(-1===$j.inArray(f,b)||null==f)return c.hierarchyLevel=0,d.push(c),e.push(a),!0});$j.each(e.reverse(),function(b,c){a.splice(c,1)});for(var e=[],f=[],a=a.reverse(),
g=0;5>g;g++)$j.each(a,function(a,b){blanketObj=sidebarProjectMapper(d);c=blanketObj.returnObj;sortedArr=blanketObj.returnArr;var h=b.project.TASKRAY__Project_Parent__c;if(-1!==$j.inArray(h,sortedArr))return b.hierarchyLevel=d[c[h]].hierarchyLevel+1,f.push(h),d.splice(c[h]+1,0,b),e.push(a),g--,!1}),$j.each(e.reverse(),function(b,c){a.splice(c,1)}),e=[];0<a.length&&($j.each(a,function(a,b){b.hierarchyLevel=0;b.project.TASKRAY__Project_Parent__c="";d.push(b);e.push(a)}),$j.each(e.reverse(),function(b,
c){a.splice(c,1)}));$j.each(d,function(a,b){if($j.inArray(b.project.Id,f)!==-1)b.hasChildren=true});return d}function sidebarProjectMapper(a){var b={},c={},d=[];$j.each(a,function(a,b){null!=b.project.Id&&(c[b.project.Id]=a,d.push(b.project.Id))});b.returnObj=c;b.returnArr=d;return b}var sidebarCollapsedItems=[];
function toggleSidebarProjectCollapse(a){idsToHide={};idsToHide[a]=a;for(var b=0;6>b;b++)$j.each(idsToHide,function(b,d){$j(".project-select[child-of-node="+d+"]").each(function(){if(-1===$j.inArray(d,sidebarCollapsedItems)||d==a)idsToHide[$j(this).attr("id")]=$j(this).attr("id")})});idArrToHide=[];$j.each(idsToHide,function(b){a!=b&&idArrToHide.push("#projects-sidebar #"+b)});b="true"!=$j("#"+a).attr("collapsed")?"collapse":"expand";"expand"==b?($j(idArrToHide.join()).show(),$j("#"+a).attr("collapsed",
"false"),$j("#"+a+" .project-collapse-container a").removeClass("plus").addClass("minus"),sideBarWiggleFixForChrome()):"collapse"==b&&($j(idArrToHide.join()).hide(),$j("#"+a).attr("collapsed","true"),$j("#"+a+" .project-collapse-container a").removeClass("minus").addClass("plus"),sideBarWiggleFixForChrome());sidebarCollapsedItems.length=0;$j('#projects-sidebar .project-select[collapsed="true"]').each(function(){sidebarCollapsedItems.push($j(this).attr("id"))});$j.cookie("bltr_sidebarcollapsed",JSON.stringify(sidebarCollapsedItems),
{expires:365,path:"/",secure:!0})}function applyPersistedSidebarCollapse(){var a=JSON.parse($j.cookie("bltr_sidebarcollapsed"));null!=a&&$j.each(a,function(a,c){"true"!=$j("#projects-sidebar #"+c).attr("collapsed")&&$j("#projects-sidebar #"+c+" .project-collapse-container").trigger("click")})}
function getGroupId(){var a="";if("group"==currentBoardId)if(null!=$j.cookie("apex__bltr-selected-group")){var b=!1;$j("#chatter-group-dropdown option").each(function(){$j(this).val()==$j.cookie("apex__bltr-selected-group")&&(b=!0,a=$j.cookie("apex__bltr-selected-group"))});!1==b&&(a=$j("#chatter-group-dropdown").val())}else a=$j("#chatter-group-dropdown").val();return a};function updateSortOrdersForListWithNoMovement(a){var b=listNameArr[a];taskArray=$j("#column-"+a).sortable("toArray");TASKRAY.trController.updateSortOrder(taskArray,b,"0",function(){})}
function updateTaskArray(a,b,c,d,e){skipPoll=!0;TASKRAY.trController.updateSortOrder(a,b,c,function(a,c){if(c.status)null!=e&&populateTask(e,!0);else{var d=e.length,l=!1;$j.each(e,function(a,b){if(void 0!==b&&"undefined"!==typeof b){var f=originalPositions[b].columnIndex,p=originalPositions[b].columnId;0==f?$j("#"+b).prependTo($j("#"+p)):0!==$j("#"+p).children().eq(f-1).length?$j("#"+b).insertAfter($j("#"+p).children().eq(f-1)):$j("#"+b).appendTo($j("#"+p));parsedMsg=c.message.replace(/.*First\sexception.*first\serror\:\s\w*,/,
"");parsedMsg=parsedMsg.replace(/\:\s\[\]/,"");if((1==e.length||-1!==c.message.indexOf(b)||a==d-1)&&!1==l)advancedAddLightBox(parsedMsg+"<br />Whoops! TaskRay could not change the list for this task. Check for any required fields or validation rules.",b),l=!0}});updateColumnCounts()}b==lastListColName&&checkForTaskBoardChanges(!0);skipPoll=!1},{escape:!0})}var draggedItem,originalPositions={};
function attachSortable(){$j.each(listNameArr,function(a,b){$j("#column-"+a).sortable({cancel:".sort-disabled",placeholder:"ui-state-highlight",activate:function(){},scroll:!1,deactivate:function(){stopAllScrolling()},over:function(){$j(this).find(".narrowplaceholder").remove()},out:function(){},receive:function(a,b){$j(this).stop();$j("#column-container").unbind("mousemove",moved);currentTaskId=$j(b.item).attr("id");stopAllScrolling()},update:function(a,d){$j(this).stop();$j("#column-container").unbind("mousemove",
moved);currentTaskId=$j(d.item).attr("id");stopAllScrolling();updateColumnCounts();0!=$j(d.item).children(".beforedragged").length&&($j(d.item).children(".beforedragged").children(".task").insertBefore(d.item),$j(d.item).children(".beforedragged").remove());0!=$j(d.item).children(".afterdragged").length&&($j(d.item).children(".afterdragged").children(".task").insertAfter(d.item),$j(d.item).children(".afterdragged").remove());array=$j(this).sortable("toArray");arg1=b;arg2="";arg3=d.item;currentTaskId=
$j(d.item).attr("id");var e=[currentTaskId];$j(draggedItem.siblings(".selected-task")).each(function(){e.push($j(this).attr("id"))});var f=!1,g={name:"taskListChanged",data:[]};$j.each(e,function(a,c){var d=findTaskInSortable(persistedsortable,c);if(b!=d.task.TASKRAY__List__c){f=true;g.data.push({taskId:c,oldSortOrder:d.sortOrder,oldListName:d.task.TASKRAY__List__c})}});f&&addUndoEvent(g);setTimeout(function(){updateTaskArray(array,arg1,arg2,arg3,e)},500);skipPoll=!0;stopAllScrolling()},start:function(a,
b){dragging=sorting=!0;draggedItem=b.item;originalPositions[$j(b.item).attr("id")]={columnId:$j(b.item).parent().attr("id"),columnIndex:$j(b.item).index()};if(0!==b.item.siblings(".selected-task").length){$j(draggedItem.siblings(".selected-task")).each(function(){originalPositions[$j(this).attr("id")]={columnId:$j(this).parent().attr("id"),columnIndex:$j(this).index()}});var e=draggedItem.index();$j(draggedItem.siblings(".selected-task")).each(function(){$j(this).index()<e?(0==$j(draggedItem).children(".beforedragged").length&&
$j('<div class="beforedragged">').prependTo(draggedItem),$j(this).appendTo(draggedItem.children(".beforedragged"))):(0==$j(draggedItem).children(".afterdragged").length&&$j('<div class="afterdragged">').appendTo(draggedItem),$j(this).appendTo(draggedItem.children(".afterdragged")))})}$j("#column-container").mousemove(moved)},stop:function(){dragging=!1;stopAllScrolling();$j("#column-container").unbind("mousemove",moved)}})});$j(".sortable-list").sortable("option","connectWith",".sortable-list")}
function stopAllScrolling(){$j(".sortable-list").each(function(){$j(this).stop()});$j(".sortable-list").clearQueue("fx")}
function moved(a){draggedItem.position();draggedItem.height();draggedItem.width();var b=!1;$j(".sortable-list").each(function(){var c=$j(this).offset().top,d=$j(this).offset().left,e=$j(this).width()+d+20,f=$j(this).height(),g=f+c-40,f=f+c+40;a.pageX>d&&a.pageX<e&&(a.pageY>c-40&&a.pageY<c+40?($j(this).scrollTo("-=40px",300),b=!0):a.pageY>g&&a.pageY<f?($j(this).scrollTo("+=40px",300),b=!0):($j(this).stop(),b=!1))});b||stopAllScrolling()};function attachTaskClickOnFunctions(){$j("#view").on("click",".taskcard-cog-icon",function(a){a.stopPropagation();showProjectTaskModal($j(this).parentsUntil(".task").parent().attr("id"))});$j("#view").on("click",".taskcard-next-icon",function(a){a.preventDefault();a.stopPropagation();var b=$j(this).parents(".task,.deadline-view-task"),a=$j(b).attr("id"),b=$j(b).hasClass("deadline-view-task")?parseInt($j(this).attr("colnum")):parseInt($j(b).parents(".task-column").attr("colnum"));moveTasksToColumn([a],
b+1)});$j("#view").on("click",".taskcard-follow-toggle",function(a){a.preventDefault();a.stopPropagation();var b=$j(this).parents(".task").attr("id");skipPoll=!0;TASKRAY.trController.toggleFollowTask(b,function(a,d){d.status&&populateTask([b],!0);skipPoll=!1},{escape:!0})});$j("#view").on("click",".deadline-view-task",function(){$j("#task-frame").contents().empty();$j("#task-frame").attr("src",trProjectTaskPage+"?Id="+$j(this).attr("id")+"&controller=projecttask");$j("#task-modal").modal("show");
sorting=!1});$j("#view").on("click",".task",function(a){var b;!a.metaKey&&!a.ctrlKey&&(b=$j(".selected-task").not($j(this)).removeClass("selected-task"));$j(this).hasClass("selected-task")&&(a.metaKey||a.ctrlKey)?$j(this).removeClass("selected-task"):$j(this).hasClass("selected-task")&&0==b.length?$j(this).removeClass("selected-task"):$j(this).addClass("selected-task")})}function attachTaskClickFunctions(){}
function moveTasksToColumn(a,b){skipPoll=!0;var c=null,d={name:"taskListChanged",data:[]},e=listNameArr[b];$j.each(a,function(a,e){var j="deadline"==$j.cookie("bltr_view")?$j("#"+e+".deadline-view-task"):$j("#"+e);isDeadlineTask=!1;$j(j).hasClass("deadline-view-task")&&(isDeadlineTask=!0);var l=$j(j).attr("id");parseInt($j(j).parents(".task-column").attr("colnum"));var h=$j(j).parent().attr("id"),m=$j(j).index();originalPositions[l]={columnId:h,columnIndex:m};isDeadlineTask&&parseInt($j(this).attr("colnum"));
c=b<listNameArr.length?b:null;if(null==c)return!1;h=listNameArr[c];isDeadlineTask||$j("#column-"+c).prepend(j);updateColumnCounts();lastManualDOMChange=(new Date).getTime();isDeadlineTask&&TASKRAY.trController.updateTasksStatus(l,h,function(){populateDeadlineView()});j=findTaskInSortable(persistedsortable,e);d.data.push({taskId:e,oldSortOrder:j.sortOrder,oldListName:j.task.TASKRAY__List__c})});null!=c&&(addUndoEvent(d),"deadline"!=$j.cookie("bltr_view")&&(taskArray=$j("#column-"+b).sortable("toArray"),
updateTaskArray(taskArray,e,"0",null,a)))}var updateListSortOrderOnHighlight=null;
function scrollToAndHighlightTask(a){if(null!=a){15==a.length&&(a=normalizeSFID(a));null!=updateListSortOrderOnHighlight&&(updateSortOrdersForListWithNoMovement(listNameMap[updateListSortOrderOnHighlight]),updateListSortOrderOnHighlight=null);$j(".kanban-column").css("position","relative");var b=$j("#viewport-container"),c=$j("#"+a);if(0!=c.length){var d=c.parents(".task-column");d.is(":visible")||$j("#action-bar-button-column-"+d.attr("colnum")).find("a").trigger("click");var e=c.parents(".kanban-column"),
c=c.position().top+e.scrollTop(),d=d.position().left+b.scrollLeft();(c<e.scrollTop()||c>e.scrollTop()+e.height())&&e.scrollTop(c);(d<b.scrollLeft()||d>b.scrollLeft()+b.width())&&b.scrollLeft(d);$j(".kanban-column").css("position","static");$j("#"+a).find(".taskcard-wrapper").effect("highlight",{},6E3)}}};function attachUiHelperMessages(){$j("#bracket-labs-feedback").tooltip({placement:"bottom",delay:{show:500,hide:100}});$j("#project-sidebar-header").tooltip({placement:"left",delay:{show:500,hide:100}});$j("#group-members-sidebar-header").tooltip({placement:"left",delay:{show:500,hide:100}});$j("#project-files-list").tooltip({placement:"left",delay:{show:500,hide:100}});$j(".project-action-icon-editContribs-tooltip").tooltip({placement:"left",delay:{show:500,hide:100}});$j("#groups-sidebar-header").tooltip({placement:"left",
delay:{show:500,hide:100}});$j("#groups-sidebar-header-info").popover({placement:"left",trigger:"manual"});bindClickFunction($j("#groups-sidebar-header-info"),function(){$j(this).popover("toggle")});$j("#group-members-sidebar-header").popover({placement:"left",trigger:"manual"});$j("#groups-sidebar-members-info").popover({placement:"left",trigger:"manual"});bindClickFunction($j("#groups-sidebar-members-info"),function(){$j(this).popover("toggle")});$j("#search-modal-info").popover({placement:"right",
trigger:"manual"});bindClickFunction($j("#search-modal-info"),function(){$j(this).popover("toggle")})};